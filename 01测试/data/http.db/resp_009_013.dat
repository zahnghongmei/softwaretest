(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-476c"],{"1Xeb":function(module,exports,__webpack_require__){},"3Fq5":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("vRkX");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__).a},"3Y9q":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_152b4c9a_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("EtFR");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_152b4c9a_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},ESly:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_eabe9854_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("uv2G");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_eabe9854_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},EtFR:function(module,exports,__webpack_require__){},Gc8S:function(module,__webpack_exports__,__webpack_require__){"use strict";var components_breadcrumbvue_type_script_lang_js_={props:{breadcrumb:Array},methods:{handleClick:function(_ref){var _ref$item=_ref.item,item=void 0===_ref$item?{fabid:0}:_ref$item;this.$store.commit("setAddressBread",item),this.$store.commit("setSectionId",item.fabid)}},computed:{componyName:function(){return this.$store.state.componyName}}},componentNormalizer=(__webpack_require__("PSuk"),__webpack_require__("KHd+")),component=Object(componentNormalizer.a)(components_breadcrumbvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"item",on:{click:function($event){return $event.stopPropagation(),_vm.handleClick($event)}}},[_vm._v("\n    "+_vm._s(_vm.componyName)+"\n  ")]),_vm._v(" "),_vm._l(_vm.breadcrumb,function(item){return _c("div",{key:item.fabid,staticClass:"item",on:{click:function($event){$event.stopPropagation(),_vm.handleClick({item:item})}}},[_vm._v("\n    "+_vm._s(item.fabname)+"\n  ")])})],2)},[],!1,null,"dcf572ae",null);component.options.__file="index.vue";__webpack_exports__.a=component.exports},OPzi:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_4cf8bafe_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("fpiZ");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_4cf8bafe_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},PSuk:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_dcf572ae_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("qzO4");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_dcf572ae_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},RGWy:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_5081f755_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("1Xeb");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_5081f755_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},Va1t:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("pKq2");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__).a},fpiZ:function(module,exports,__webpack_require__){},iwLr:function(module,__webpack_exports__,__webpack_require__){"use strict";var helpers_extends=__webpack_require__("QbLZ"),extends_default=__webpack_require__.n(helpers_extends),promise=__webpack_require__("4d7F"),promise_default=__webpack_require__.n(promise);function sendPrivateText(conn,data){return new promise_default.a(function(resolve,reject){var msg=new WebIM.message(data.msg_type,data.msg_id);msg.set(extends_default()({},JSON.parse(data.payload),{to:data.to_user,roomType:!1,ext:extends_default()({custom_msg_id:data.msg_id},JSON.parse(data.payload).ext),success:function(){resolve()},fail:function(e){reject(e)}})),msg.body.chatType="singleChat",conn.send(msg.body)})}function sendGroupText(conn,data){return new promise_default.a(function(resolve,reject){var msg=new WebIM.message(data.msg_type,data.msg_id);msg.set({msg:JSON.parse(data.payload).msg,to:data.to_user,roomType:!1,chatType:"chatRoom",ext:extends_default()({custom_msg_id:data.msg_id},JSON.parse(data.payload).ext),success:function(){resolve()},fail:function(e){reject(e)}}),msg.setGroup("groupchat"),conn.send(msg.body)})}var element_ui_common=__webpack_require__("XJYT");function sendPrivateImg(conn,data,file){return new promise_default.a(function(resolve,reject){var msg=new WebIM.message("img",data.msg_id),option={apiUrl:WebIM.config.apiURL,file:file,to:data.easemobname,roomType:!1,chatType:data.chatType,ext:{custom_msg_id:data.msg_id},onFileUploadError:function(){element_ui_common.Notification.error({title:"失败",message:file.filename+" 上传失败"})},onFileUploadComplete:function(res){resolve()},success:function(){},error:function(){reject()},flashUpload:WebIM.flashUpload};msg.set(option),conn.send(msg.body)})}function sendPrivateFile(conn,data,file){return new promise_default.a(function(resolve,reject){var msg=new WebIM.message("file",data.msg_id),option={apiUrl:WebIM.config.apiURL,file:file,to:data.easemobname,roomType:!1,chatType:data.chatType,ext:{custom_msg_id:data.msg_id},onFileUploadError:function(){element_ui_common.Notification.error({title:"失败",message:file.filename+" 上传失败"})},onFileUploadComplete:function(res){resolve()},success:function(){},error:function(){reject("error")},flashUpload:WebIM.flashUpload};msg.set(option),conn.send(msg.body)})}function createGroupNew(conn,data){return new promise_default.a(function(resolve){var options={data:extends_default()({desc:"",members:[]},data,{maxusers:2e3}),success:function(respData){resolve(respData)},error:function(){}};conn.createGroupNew(options)})}function changeGroupInfo(conn,roomId,subject){return new promise_default.a(function(resolve){var option={roomId:roomId,subject:subject,description:"",maxusers:2e3,success:function(){resolve("success")},error:function(){element_ui_common.Notification.error({title:"失败",message:"群信息修改失败"})}};conn.changeGroupSubject(option)})}function leaveGroup(conn,to,roomId){return new promise_default.a(function(resolve,reject){var option={to:to,roomId:roomId,success:function(){resolve("success")},error:function(e){reject(e)}};conn.leaveGroupBySelf(option)})}function addGroupMembers(conn,list,roomId){return new promise_default.a(function(resolve){var option={list:list,roomId:roomId,success:function(){resolve("success")}};conn.addGroupMembers(option)})}function dissolveGroup(conn,groupId){return new promise_default.a(function(resolve,reject){var option={groupId:groupId,success:function(){resolve("success")},error:function(e){reject(e)}};conn.dissolveGroup(option)})}function groupBlockSingle(conn,groupId,username){return new promise_default.a(function(resolve){var options={groupId:groupId,username:username,success:function(resp){resolve(resp)},error:function(){element_ui_common.Notification.error({title:"失败",message:"踢出成员失败"})}};conn.groupBlockSingle(options)})}function removeGroupBlockMulti(conn,groupId,username){return new promise_default.a(function(resolve){var options={groupId:groupId,username:username,success:function(resp){resolve(resp)},error:function(){}};conn.groupBlockSingle(options)})}function getGroup(conn){return new promise_default.a(function(resolve){var options={success:function(resp){resolve(resp)},error:function(e){}};conn.getGroup(options)})}function queryRoomInfo(conn,id){return new promise_default.a(function(resolve){conn.queryRoomInfo({roomId:id,success:function(settings,members,fields){console.log("settings: ",settings),console.log("members: ",members),console.log("fields: ",fields)},error:function(){console.log("Error!")}})})}__webpack_require__.d(__webpack_exports__,"m",function(){return sendPrivateText}),__webpack_require__.d(__webpack_exports__,"j",function(){return sendGroupText}),__webpack_require__.d(__webpack_exports__,"l",function(){return sendPrivateImg}),__webpack_require__.d(__webpack_exports__,"k",function(){return sendPrivateFile}),__webpack_require__.d(__webpack_exports__,"c",function(){return createGroupNew}),__webpack_require__.d(__webpack_exports__,"b",function(){return changeGroupInfo}),__webpack_require__.d(__webpack_exports__,"g",function(){return leaveGroup}),__webpack_require__.d(__webpack_exports__,"a",function(){return addGroupMembers}),__webpack_require__.d(__webpack_exports__,!1,function(){}),__webpack_require__.d(__webpack_exports__,!1,function(){}),__webpack_require__.d(__webpack_exports__,"d",function(){return dissolveGroup}),__webpack_require__.d(__webpack_exports__,"f",function(){return groupBlockSingle}),__webpack_require__.d(__webpack_exports__,"i",function(){return removeGroupBlockMulti}),__webpack_require__.d(__webpack_exports__,"e",function(){return getGroup}),__webpack_require__.d(__webpack_exports__,"h",function(){return queryRoomInfo})},kA96:function(module,__webpack_exports__,__webpack_require__){"use strict";var promise=__webpack_require__("4d7F"),promise_default=__webpack_require__.n(promise),helpers_extends=__webpack_require__("QbLZ"),extends_default=__webpack_require__.n(helpers_extends),stringify=__webpack_require__("gDS+"),stringify_default=__webpack_require__.n(stringify),singleAvator=__webpack_require__("dTSq"),newGroup_allContactsvue_type_script_lang_js_={components:{SingleAvator:singleAvator.a},props:{datas:Object,checkedSections:Array,checkedPersons:Array,isDefault:Array,loading:Boolean},data:function(){return{checkAll:!1,isIndeterminate:!1,checks:[]}},watch:{datas:{immediate:!0,handler:function(){this.checkStatus()}},checkedSections:{immediate:!0,handler:function(value){this.checks=value.map(function(v){return v.fabid}),this.checkStatus()}},checkedPersons:{immediate:!0,handler:function(value){this.checkStatus()}}},methods:{handleCheckAllChange:function(val){var _this=this,checkedSections=this.checkedSections,checkedPersons=this.checkedPersons,datas=this.datas;val?(checkedSections=this.$options.filters.deWeight(checkedSections,datas.departmentList,"fabid"),checkedPersons=this.$options.filters.deWeight(checkedPersons,datas.memberList,"usercode")):(datas.departmentList.map(function(v){var index=checkedSections.findIndex(function(c){return c.fabid===v.fabid});-1!==index&&checkedSections.splice(index,1)}),datas.memberList.map(function(v){if(!_this.isDefault.includes(v.usercode)){var index=checkedPersons.findIndex(function(c){return c.usercode===v.usercode});-1!==index&&checkedPersons.splice(index,1)}})),this.isIndeterminate=!1,this.$emit("update:checkedSections",checkedSections),this.$emit("update:checkedPersons",checkedPersons)},checkStatus:function(){var checkedSections=this.checkedSections,checkedPersons=this.checkedPersons,datas=this.datas,checkDepAll=datas.departmentList.every(function(v){return checkedSections.map(function(v){return v.fabid}).includes(v.fabid)}),checkMemAll=datas.memberList.every(function(v){return checkedPersons.map(function(v){return v.usercode}).includes(v.usercode)});if(this.checkAll=checkDepAll&&checkMemAll,checkDepAll&&checkMemAll)this.isIndeterminate=!1;else{var checkDep=datas.departmentList.some(function(v){return checkedSections.map(function(v){return v.fabid}).includes(v.fabid)}),checkMem=datas.memberList.some(function(v){return checkedPersons.map(function(v){return v.usercode}).includes(v.usercode)});this.isIndeterminate=checkDep||checkMem}},handleCheckedSectionsChange:function(value){var checkedSections=this.checkedSections,index=checkedSections.findIndex(function(c){return c.fabid===value.fabid});-1===index?checkedSections.push(value):checkedSections.splice(index,1),this.$emit("update:checkedSections",checkedSections)},handleCheckedPersonChange:function(value){if(!this.isDefault.includes(value.usercode)){var checkedPersons=this.checkedPersons,index=checkedPersons.findIndex(function(c){return c.usercode===value.usercode});-1===index?checkedPersons.push(value):checkedPersons.splice(index,1),this.$emit("update:checkedPersons",checkedPersons)}},handleSectionClick:function(item){this.checkedSections.some(function(v){return v.fabid===item.fabid})||(this.$store.commit("setSectionId",item.fabid),this.$store.commit("setAddressBread",item))}},computed:{compname:function(){return this.$store.state.componyName}}},componentNormalizer=(__webpack_require__("ESly"),__webpack_require__("3Fq5"),__webpack_require__("KHd+")),component=Object(componentNormalizer.a)(newGroup_allContactsvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"allContacts"},[_c("div",{staticClass:"title"},[_vm._v("选择联系人：")]),_vm._v(" "),_c("div",{staticClass:"box"},[_c("div",{staticClass:"componyName"},[_vm._v(_vm._s(_vm.compname))]),_vm._v(" "),_c("el-scrollbar",{directives:[{name:"loading",rawName:"v-loading",value:_vm.loading,expression:"loading"}],ref:"scrollbar",staticClass:"main-scroll",attrs:{tag:"div"}},[_c("el-checkbox",{staticClass:"checkbox checkAll",attrs:{indeterminate:_vm.isIndeterminate},on:{change:_vm.handleCheckAllChange},model:{value:_vm.checkAll,callback:function($$v){_vm.checkAll=$$v},expression:"checkAll"}},[_vm._v("\n        全选\n      ")]),_vm._v(" "),_c("div",{staticClass:"contacts"},[_c("el-checkbox-group",{staticClass:"checkgroup",model:{value:_vm.checks,callback:function($$v){_vm.checks=$$v},expression:"checks"}},_vm._l(_vm.datas.departmentList,function(section){return _c("el-checkbox",{key:section.fabid,staticClass:"checkbox",attrs:{label:section.fabid},on:{change:function($event){_vm.handleCheckedSectionsChange(section)}}},[_vm._v("\n            "+_vm._s(section.fabname)+"\n          ")])})),_vm._v(" "),_c("div",{staticClass:"right"},_vm._l(_vm.datas.departmentList,function(section){return _c("div",{key:section.fabname,class:["checkbox",{disabled:_vm.checkedSections.some(function(v){return v.fabid===section.fabid})}],on:{click:function($event){_vm.handleSectionClick(section)}}},[_c("span",{staticClass:"compony"},[_vm._v(_vm._s(section.fabname))]),_vm._v(" "),_c("span",{staticClass:"number"},[_vm._v(_vm._s(section.memberCount)+"人")])])}))],1),_vm._v(" "),_c("div",{staticClass:"person"},_vm._l(_vm.datas.memberList,function(item){return _c("single-avator",{key:item.usercode,staticClass:"checkbox personItem",attrs:{nickname:item.username,usercode:item.usercode,avator:item.headimg,checks:_vm.checkedPersons.map(function(v){return v.usercode}),circle:"",checkable:""},on:{click:function($event){_vm.handleCheckedPersonChange(item)}}})}))],1)],1)])},[],!1,null,"eabe9854",null);component.options.__file="index.vue";var allContacts=component.exports,toConsumableArray=__webpack_require__("m1cH"),toConsumableArray_default=__webpack_require__.n(toConsumableArray),lodash=__webpack_require__("LvDl"),actions=__webpack_require__("9At1"),newGroup_newContactsvue_type_script_lang_js_={components:{SingleAvator:singleAvator.a},props:{datas:Object,checkedSections:Array,checkedPersons:Array,isDefault:Array,userGroupname:String,noName:Boolean,maxusers:Number,total:Number},data:function(){return{searchValue:"",placeholder:"搜索联系人姓名...",isSearch:!1,searchLists:[],loading:!1,isTotal:!1}},watch:{checkedSections:{deep:!0,handler:function(){this.getUsersByFabids()}},checkedPersons:{deep:!0,handler:function(){this.getUsersByFabids()}}},mounted:function(){var _this=this;this.$nextTick(function(){_this.$refs.search.focus()})},methods:{setGroupname:function(e){29<e.target.value.length&&this.$notify.info({title:"提示",message:"群名称长度不得超过30个字符"}),this.$emit("update:userGroupname",e.target.value)},handleBlur:function(){var _this2=this;setTimeout(function(){_this2.isSearch=!1,_this2.searchValue="",_this2.searchLists=[]},500)},findGroupinfoByKey:function(value){var _this3=this;value!==this.searchValue&&(value?(this.searchValue=value,actions.l({keyword:value,type:"user"}).then(function(res){200===res.code&&(_this3.searchLists=res.result),_this3.loading=!1})):this.searchValue="")},handleSearch:function(e){var _this4=this;this.loading=!0,Object(lodash.debounce)(function(){return _this4.findGroupinfoByKey(e.target.value)},100,{maxWait:500})()},handleKeyDown:function(event){if(event.stopPropagation(),this.total&&!this.searchValue&&8===event.keyCode){var choosePerson=this.choosePerson,checkedSections=this.checkedSections,tag=choosePerson.length?choosePerson[choosePerson.length-1]:checkedSections[checkedSections.length-1];this.handleClose(tag)}},handleAdd:function(item){var checked=this.checkedPersons.slice();-1===checked.findIndex(function(v){return v.usercode===item.usercode})?checked.push(item):this.$notify.warning({title:"警告",message:"不能添加相同的联系人"}),this.$emit("update:checkedPersons",checked)},handleClose:function(tag){if(tag.usercode){var checkedPersons=[].concat(toConsumableArray_default()(this.checkedPersons)),index=checkedPersons.findIndex(function(v){return v.usercode===tag.usercode});-1!==index&&checkedPersons.splice(index,1),this.$emit("update:checkedPersons",checkedPersons)}else{var checkedSections=[].concat(toConsumableArray_default()(this.checkedSections)),_index=checkedSections.findIndex(function(v){return v.fabid===tag.fabid});-1!==_index&&checkedSections.splice(_index,1),this.$emit("update:checkedSections",checkedSections)}},getUsersByFabids:function(){var _this5=this;this.isTotal=!0;var sectionId=this.checkedSections.map(function(v){return v.fabid});if(!sectionId.length){var total=this.checkedPersons.filter(function(v){return!_this5.isDefault.includes(v.usercode)}).length;return this.$emit("update:total",total),void(this.isTotal=!1)}actions.G(sectionId).then(function(res){if(200===res.code){var _total=_this5.$options.filters.deWeight(_this5.checkedPersons,res.result,"usercode").filter(function(v){return!_this5.isDefault.includes(v.usercode)}).length;_this5.$emit("update:total",_total)}_this5.isTotal=!1}).catch(function(_){return _this5.isTotal=!1})}},computed:{componyName:function(){return this.$store.state.componyName},choosePerson:function(){var _this6=this;return this.checkedPersons.filter(function(v){return!_this6.isDefault.includes(v.usercode)})}}},newContacts_component=(__webpack_require__("RGWy"),__webpack_require__("Va1t"),Object(componentNormalizer.a)(newGroup_newContactsvue_type_script_lang_js_,function(){var this$1=this,_vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{class:["newContacts",{noname:_vm.noName}]},[_c("div",{staticClass:"title"},[_c("div",[_vm._v("新添成员：")]),_vm._v(" "),_c("div",{staticClass:"checkTotal"},[_vm._v("已选\n      "),_c("el-button",{class:{danger:_vm.total>_vm.maxusers},staticStyle:{padding:"0"},attrs:{loading:_vm.isTotal,type:"text"}},[_vm._v(_vm._s(_vm.isTotal?"":_vm.total))]),_vm._v("/"+_vm._s(_vm.maxusers)+" 人")],1)]),_vm._v(" "),_c("div",{class:["box",{search:_vm.isSearch}],on:{click:function(){return this$1.$refs.search.focus()}}},[_c("el-scrollbar",{ref:"scrollbar",staticClass:"main-scroll",attrs:{tag:"div"}},[_c("div",{staticClass:"lists"},[_vm._l(_vm.checkedSections,function(tag){return _c("el-tag",{key:tag.fabid+tag.fabname,attrs:{"disable-transitions":!1,closable:""},on:{close:function($event){_vm.handleClose(tag)}}},[_vm._v("\n          "+_vm._s(tag.fabname)+"\n        ")])}),_vm._v(" "),_vm._l(_vm.choosePerson,function(tag){return _c("el-tag",{key:tag.usercode+tag.username,attrs:{"disable-transitions":!1,closable:""},on:{close:function($event){_vm.handleClose(tag)}}},[_vm._v("\n          "+_vm._s(tag.username)+"\n        ")])}),_vm._v(" "),_c("el-input",{ref:"search",staticClass:"contactSearch",attrs:{value:_vm.searchValue,size:"small",placeholder:_vm.searchValue||_vm.total?"":_vm.placeholder,"auto-complete":"off"},on:{focus:function($event){_vm.isSearch=!0},blur:_vm.handleBlur},nativeOn:{input:function($event){return _vm.handleSearch($event)},keydown:function($event){return _vm.handleKeyDown($event)}}})],2),_vm._v(" "),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.searchValue,expression:"searchValue"},{name:"loading",rawName:"v-loading",value:_vm.loading,expression:"loading"}],staticClass:"searchMask"},[_c("div",{directives:[{name:"show",rawName:"v-show",value:!_vm.searchLists.length&&!_vm.loading,expression:"!searchLists.length && !loading"}],staticClass:"nothing"},[_vm._v("暂无匹配联系人")]),_vm._v(" "),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.searchLists.length,expression:"searchLists.length"}],staticClass:"title"},[_vm._v(_vm._s(_vm.componyName))]),_vm._v(" "),_vm._l(_vm.searchLists,function(item){return _c("single-avator",{key:item.usercode,staticClass:"item personItem",attrs:{nickname:item.username,usercode:item.usercode,avator:item.headimg,circle:"",checkable:""},nativeOn:{click:function($event){_vm.handleAdd(item)}}})})],2)])],1),_vm._v(" "),_vm.noName?_vm._e():_c("div",{staticClass:"setGronpname"},[_c("div",[_vm._v("群名称：")]),_vm._v(" "),_c("el-input",{attrs:{value:_vm.userGroupname,maxlength:30,clearable:"",placeholder:"请输入群名称（非必填）","auto-complete":"off"},nativeOn:{input:function($event){return _vm.setGroupname($event)}}})],1)])},[],!1,null,"5081f755",null));newContacts_component.options.__file="index.vue";var newContacts=newContacts_component.exports,breadcrumb=__webpack_require__("Gc8S"),easemob=__webpack_require__("iwLr"),newGroup_contactsvue_type_script_lang_js_={components:{Breadcrumb:breadcrumb.a,AllContacts:allContacts,NewContacts:newContacts},props:{isDefault:{type:Array,default:function(){return[]}},groupid:String,groupname:{type:String,default:""},noName:Boolean},data:function(){return{datas:{departmentList:[],memberList:[]},sections:[],persons:[],userGroupname:"",isWait:!1,loading:!1,total:0,maxusers:2e3}},watch:{sectionId:{immediate:!0,handler:function(value){var _this=this;if(this.loading=!0,value)actions.z(value).then(function(res){if(200===res.code){var result=res.result;result.memberList.map(function(v){v.fabid||(v.fabids=value)}),_this.datas=result}_this.loading=!1}).catch(function(_){return _this.loading=!1});else{var compid=this.$store.state.compid;actions.y(compid).then(function(res){200===res.code&&(_this.datas={departmentList:res.result,memberList:[]}),_this.loading=!1}).catch(function(_){return _this.loading=!1})}}},isDefault:{immediate:!0,deep:!0,handler:function(value){this.persons=JSON.parse(stringify_default()(value))}},groupname:{immediate:!0,handler:function(value){this.userGroupname=value}}},created:function(){this.$store.getters.initAddressBread},methods:{handleClose:function(){this.sections=[],this.persons=JSON.parse(stringify_default()(this.isDefault)),this.$emit("close")},handleLink:function(){this.$notify.success({title:"成功",message:"群组创建成功"}),"/home/message"!==this.$router.currentRoute.fullPath&&(this.$store.commit("setTotalPage",1),this.$router.push("/home/message")),this.handleClose()},getMesginfoR:function(groupid){var _this2=this;return actions.w({type:"group",fromcode:groupid,start:1,pagesize:20}).then(function(res){if(res&&200===res.code)return _this2.$store.commit("setTotalPage",res.result.totalPage),_this2.$store.commit("setMessage",res.result.list),_this2.$store.commit("setHistoryId","group"+groupid),res.result.list[res.result.list.length-1];_this2.isWait=!1}).catch(function(_){return _this2.isWait=!1})},handleAdd:function(){var _this3=this;this.total>this.maxusers?this.$notify.error({title:"失败",message:"群聊人数超过最大限制"}):this.getPersonByFabid().then(function(res){var persons=res,sliceNames=persons.map(function(v){return v.username}).slice(0,5).join(","),groupname=_this3.userGroupname?_this3.userGroupname:5<persons.length?sliceNames+" 等":sliceNames;if(_this3.groupid||_this3.$options.filters.trim(groupname))if(_this3.groupid){var exist=_this3.isDefault.map(function(v){return v.easemobname}),members=persons.filter(function(v){return!exist.includes(v.easemobname)}).map(function(v){return v.easemobname});if(0===members.length)return void _this3.$notify.success({title:"警告",message:"还未添加任何新成员"});_this3.isWait=!0,easemob.a(_this3.$imConn,members,_this3.groupid).catch(function(_){return _this3.isWait=!1}),_this3.addGroupMembers(persons,members)}else{var data={groupname:groupname,public:!0,approval:!1,allowinvites:!0,membersOnly:!1};_this3.isWait=!0,easemob.c(_this3.$imConn,data).then(function(respData){_this3.handleSuccess(data,persons,respData)}).catch(function(_){return _this3.isWait=!1})}else _this3.$notify.error({title:"警告",message:"群组名称不能仅由空格组成"})}).catch(function(_){return _this3.isWait=!1})},handleSuccess:function(data,persons,respData){var _this4=this,members=persons.map(function(v){return v.easemobname}).filter(function(v){return v&&v!==_this4.userData.easemobname}),groupid=respData.data.groupid;easemob.a(this.$imConn,members,groupid).then(function(res){var datas={groupname:data.groupname,ispublic:data.public,maxusers:_this4.maxusers,approval:data.approval,owner:_this4.userData.easemobname,timestamp:respData.timestamp,members:members,groupid:groupid};actions.e(datas).then(function(res){if(200===res.code)return _this4.getMesginfoR(groupid).then(function(res){_this4.$store.commit("addItem",extends_default()({},datas,{type:"group",guid:"group"+groupid,targetuser:groupid,timestamp:res.timestamp,payload:res.payload,pccUserInfos:persons})),_this4.$nextTick(function(){_this4.isWait=!1,_this4.handleLink()})});easemob.d(_this4.$imConn,groupid)}).catch(function(_){return _this4.isWait=!1})})},addGroupMembers:function(persons,members){var _this5=this,datas={groupid:this.groupid,timestamp:+new Date,easemobname:members};actions.a(datas).then(function(res){if(200===res.code){persons.filter(function(v){return members.includes(v.easemobname)}).map(function(v){return v.username});return _this5.getMesginfoR(datas.groupid).then(function(res){_this5.$store.commit("addItem",extends_default()({},_this5.$store.state.historyList.find(function(v){return v.groupid===datas.groupid}),{timestamp:res.timestamp,payload:res.payload,pccUserInfos:persons})),_this5.$notify.success({title:"成功添加成员"}),_this5.isWait=!1,_this5.handleClose()})}easemob.i(_this5.$imConn,_this5.groupid,members).catch(function(_){return _this5.isWait=!1}),_this5.isWait=!1}).catch(function(_){return _this5.isWait=!1})},getPersonByFabid:function(){var _this6=this,sectionId=this.sections.map(function(v){return v.fabid});if(sectionId.length)return actions.G(sectionId).then(function(res){if(200===res.code){var _persons=_this6.$options.filters.deWeight(_this6.persons,res.result,"usercode");return _persons.map(function(v){v.easemobname||(v.easemobname=v.targetuser)}),new promise_default.a(function(resolve){return resolve(_persons)})}});var persons=this.persons;return persons.map(function(v){v.easemobname||(v.easemobname=v.targetuser)}),new promise_default.a(function(resolve){return resolve(persons)})}},computed:{userData:function(){return this.$store.state.userData},addressBread:function(){return this.$store.state.addressBread},sectionId:function(){return this.$store.state.sectionId},activeItem:function(){return this.$store.getters.activeItem}}},contacts_component=(__webpack_require__("OPzi"),Object(componentNormalizer.a)(newGroup_contactsvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",[_c("breadcrumb",{staticClass:"brebox",attrs:{breadcrumb:_vm.addressBread}}),_vm._v(" "),_c("div",{staticClass:"main"},[_c("all-contacts",{attrs:{datas:_vm.datas,"checked-sections":_vm.sections,"checked-persons":_vm.persons,isDefault:_vm.isDefault.map(function(v){return v.usercode}),loading:_vm.loading},on:{"update:checkedSections":function($event){_vm.sections=$event},"update:checkedPersons":function($event){_vm.persons=$event}}}),_vm._v(" "),_c("new-contacts",{attrs:{datas:_vm.datas,"checked-sections":_vm.sections,"checked-persons":_vm.persons,userGroupname:_vm.userGroupname,isDefault:_vm.isDefault.map(function(v){return v.usercode}),noName:_vm.noName,total:_vm.total,maxusers:_vm.maxusers},on:{"update:checkedSections":function($event){_vm.sections=$event},"update:checkedPersons":function($event){_vm.persons=$event},"update:userGroupname":function($event){_vm.userGroupname=$event},"update:total":function($event){_vm.total=$event}}})],1),_vm._v(" "),_c("div",{staticClass:"dialog-footer"},[_c("el-button",{attrs:{type:"primary",round:"",loading:_vm.isWait},on:{click:_vm.handleAdd}},[_vm._v("确 定")])],1)],1)},[],!1,null,"4cf8bafe",null));contacts_component.options.__file="index.vue";__webpack_exports__.a=contacts_component.exports},pKq2:function(module,exports,__webpack_require__){},pThU:function(module,__webpack_exports__,__webpack_require__){"use strict";var components_groupAvatorvue_type_script_lang_js_={props:{item:Object,checkable:Boolean,checks:Array},data:function(){return{check:!1}},watch:{checks:{immediate:!0,handler:function(value){var _this=this;Array.isArray(value)&&(this.check=-1!==value.findIndex(function(v){return v===_this.groupid}))}}},methods:{avatorScale:function(avator){if(avator){var headimg=avator.split("resize,p_")[1];return headimg?parseInt(headimg.slice(0,3))/100:1}},handleCheck:function(){this.checkable&&this.$emit("click")}},computed:{users:function(){return this.item.pccUserInfos.slice()},groupname:function(){return this.$options.filters.currentGroupName(this.item)}}},componentNormalizer=(__webpack_require__("3Y9q"),__webpack_require__("KHd+")),component=Object(componentNormalizer.a)(components_groupAvatorvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{class:["groupAvator",{check:_vm.check}],on:{click:_vm.handleCheck}},[_c("div",{staticClass:"avators"},[_vm._l(_vm.users,function(user){return _c("div",{class:["avatorItem",{one:1===_vm.users.length,nobg:user.headimg}]},[user.headimg?_c("img",{style:{transform:"scale("+_vm.avatorScale(user.headimg)+")"},attrs:{src:user.headimg}}):_c("div",{staticClass:"nickname"},[_vm._v(_vm._s(user.username.trim().slice(-1)))])])}),_vm._v(" "),_c("i",{staticClass:"iconfont icon-check"})],2),_vm._v(" "),_c("div",{staticClass:"right"},[_c("div",[_vm._v(_vm._s(_vm.groupname))]),_vm._v(" "),_c("div",{staticClass:"describe"},[_vm._v(_vm._s(_vm.item.pccUserInfos.length)+"人")])])])},[],!1,null,"152b4c9a",null);component.options.__file="index.vue";__webpack_exports__.a=component.exports},qzO4:function(module,exports,__webpack_require__){},uv2G:function(module,exports,__webpack_require__){},vRkX:function(module,exports,__webpack_require__){}}]);