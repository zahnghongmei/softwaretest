(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-29db"],{"+XGd":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_c4a36512_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("kvwK");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_c4a36512_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},"0mCb":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_850bf04e_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("WWwK");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_850bf04e_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},"4bqT":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_e0046442_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("7EKR");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_e0046442_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},"4enB":function(module,exports,__webpack_require__){},"4kfO":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_c9a0ede4_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("lDQv");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_c9a0ede4_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},"5pCn":function(module,exports,__webpack_require__){},"60WW":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_6b0adaff_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("vSlj");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_6b0adaff_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},"7Ctf":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_052738c6_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("lWqd");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_052738c6_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},"7EKR":function(module,exports,__webpack_require__){},"8ea8":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("hwt1");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__).a},"9tVp":function(module,exports,__webpack_require__){},EkSU:function(module,exports,__webpack_require__){},HRFF:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var staticRenderFns=[function(){var _h=this.$createElement,_c=this._self._c||_h;return _c("div",[_c("img",{attrs:{src:__webpack_require__("oLvb")}})])}],helpers_extends=__webpack_require__("QbLZ"),extends_default=__webpack_require__.n(helpers_extends),actions=__webpack_require__("9At1"),components_avatorvue_type_script_lang_js_={props:{item:Object,isMessage:Boolean},data:function(){return{datas:this.item}},watch:{item:{immediate:!0,handler:function(){var _this=this;if("person"!==this.item.type||this.item.username)this.datas=this.item;else{if(!this.item.usercode||!this.item.compid)return;var user=this.notGroupUser.find(function(v){return v.usercode===_this.item.usercode});user?this.datas=extends_default()({},user):this.getPccUserInfoByUserCode(this.item.usercode,this.item.compid).then(function(res){res&&(_this.datas=extends_default()({},_this.item,res),_this.$store.commit("setNotGroupUser",extends_default()({},_this.item,res)))}).catch(function(e){_this.$store.commit("setNotGroupUser",extends_default()({},_this.item,{headimg:"",username:""}))})}}}},methods:{getPccUserInfoByUserCode:function(usercode,compid){return actions.B(usercode,compid).then(function(res){if(200===res.code)return res.result})},avatorScale:function(avator){if(avator){var headimg=avator.split("resize,p_")[1];return headimg?parseInt(headimg.slice(0,3))/100:1}return 1}},computed:{headimg:function(){var _datas=this.datas,type=_datas.type,headimg=_datas.headimg;switch(type){case"system":if(this.isMessage){var _itemLogo=JSON.parse(this.item.payload.msg).logo;headimg=_itemLogo||"../../static/images/system_icon.png"}else headimg="../../static/images/system_icon.png";break;case"app":var itemLogo="string"==typeof this.item.payload?JSON.parse(JSON.parse(this.item.payload).msg).logo:JSON.parse(this.item.payload.msg).logo;headimg=itemLogo||"../../static/images/apply_icon.png"}return headimg},users:function(){if("group"===this.datas.type)return this.datas.pccUserInfos.slice()},notGroupUser:function(){return this.$store.state.notGroupUser}}},componentNormalizer=(__webpack_require__("chFa"),__webpack_require__("KHd+")),component=Object(componentNormalizer.a)(components_avatorvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return"group"===_vm.datas.type?_c("div",{staticClass:"avator"},[_vm.datas.headimg?_c("div",{staticClass:"avatorItem radius one"},[_c("img",{staticClass:"grouphead",style:{transform:"scale("+_vm.avatorScale(_vm.datas.headimg)+")"},attrs:{src:"datas.headimg"}})]):_vm._l(_vm.users,function(user,index){return _c("div",{key:index,class:["avatorItem","radius",{blank:!user.username,one:1===_vm.users.length,nobg:user.headimg}]},[user.headimg?_c("img",{style:{transform:"scale("+_vm.avatorScale(user.headimg)+")"},attrs:{src:user.headimg}}):_c("div",{staticClass:"nickname"},[_vm._v(_vm._s(user.username.trim().slice(-1)))])])})],2):_c("div",{class:["avator","single",{nobg:_vm.datas.headimg||"person"!==_vm.datas.type}]},[_vm.datas.headimg||"person"!==_vm.datas.type?_c("img",{style:{transform:"scale("+_vm.avatorScale(_vm.headimg)+")"},attrs:{src:_vm.headimg}}):_c("div",{staticClass:"nickname"},[_vm._v(_vm._s(_vm.datas.username?_vm.datas.username.trim().slice(-2):""))])])},[],!1,null,"54966110",null);component.options.__file="index.vue";var avator=component.exports,components_itemvue_type_script_lang_js_={props:{item:Object,historyId:String},components:{Avator:avator},data:function(){return{close:!1}},methods:{handleClick:function(){this.$emit("change",this.item)},handleClose:function(){this.$emit("close",this.item)},streamIcon:function(type){var icon=void 0;switch(type){case"VOICE":icon="icon-call";break;case"VIDEO":icon="icon-video-call";break;default:icon="icon-call"}return icon}},computed:{callUser:function(){return this.$store.state.callUser},name:function(){switch(this.item.type){case"person":return this.item.username;case"group":return this.$options.filters.currentGroupName(this.item);default:return this.item.modlename}},payload:function(){return JSON.parse(this.item.payload)},username:function(){return this.$store.state.userData.username},message:function(){return this.$options.filters.message(this.item)},time:function(){return this.$options.filters.timestampToDay(this.item.timestamp)}}},item_component=(__webpack_require__("4bqT"),Object(componentNormalizer.a)(components_itemvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{class:["item",{select:_vm.item.guid===_vm.historyId,top:_vm.item.istop}],on:{click:_vm.handleClick,mouseover:function($event){_vm.close=!0},mouseout:function($event){_vm.close=!1}}},[_c("avator",{attrs:{item:_vm.item}}),_vm._v(" "),_c("div",{staticClass:"right"},[_c("div",{staticClass:"base"},[_c("div",{staticClass:"nickname"},[_vm._v(_vm._s(_vm.name))]),_vm._v(" "),_c("div",{staticClass:"time"},[_vm._v(_vm._s(_vm.time))])]),_vm._v(" "),_c("div",{staticClass:"base info"},[_vm.payload.ext&&_vm.payload.ext.streamType?_c("div",{class:["rtc-default","rtc-"+_vm.payload.ext.reason]},[_c("i",{class:["iconfont",_vm.streamIcon(_vm.payload.ext.streamType)]}),_vm._v(" "),_c("span",{staticClass:"extMessage"},[_vm._v(_vm._s(_vm.$options.filters.rtcMessage(_vm.item,{username:_vm.payload.ext.originator})))])]):_c("pre",[_vm._v(_vm._s(_vm.message))]),_vm._v(" "),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.item.no_disturb,expression:"item.no_disturb"}],staticClass:"noDisturb"},[_c("i",{staticClass:"iconfont icon-no_disturb"}),_vm._v(" "),_c("span",{directives:[{name:"show",rawName:"v-show",value:_vm.item.unread,expression:"item.unread"}],staticClass:"redPoint"})]),_vm._v(" "),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.item.unread&&!_vm.item.no_disturb,expression:"item.unread && !item.no_disturb"}],staticClass:"point"},[_c("span",{class:{scale:99<_vm.item.unread}},[_vm._v(_vm._s(99<_vm.item.unread?"99+":_vm.item.unread))])])])]),_vm._v(" "),_c("i",{directives:[{name:"show",rawName:"v-show",value:_vm.close,expression:"close"}],staticClass:"close iconfont icon-close",on:{click:function($event){return $event.stopPropagation(),_vm.handleClose($event)}}})],1)},[],!1,null,"e0046442",null));item_component.options.__file="index.vue";var message_historyListvue_type_script_lang_js_={components:{Item:item_component.exports},created:function(){var _this=this;this.$root.eventHub.$on("itemChange",function(value){_this.handleChange(value)})},methods:{getMesginfoR:function(item){var _this2=this;this.$store.commit("setMessageWait",!0),actions.w({type:item.type,fromcode:item.targetuser,start:1,pagesize:20,appName:item.modlename||"111"}).then(function(res){res&&200===res.code&&(_this2.$store.commit("setMessage",res.result.list),_this2.$store.commit("setTotalPage",res.result.totalPage),_this2.$store.commit("updateItem",extends_default()({},item,{unread:0}))),_this2.$store.commit("setMessageWait",!1)}).catch(function(_){return _this2.$store.commit("setMessageWait",!1)})},handleChange:function(item){var historyId=this.historyId;item.guid!==historyId&&(this.$store.commit("clearMessage"),this.$store.commit("setHistoryId",item.guid),this.getMesginfoR(item))},handleClose:function(item){var _this3=this;this.callUser.guid===item.guid&&this.callUser.to_user?this.$msgbox.confirm("关闭窗口将挂断当前通话，确认关闭吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){_this3.$store.commit("closeItem",item.guid),_this3.$root.eventHub.$emit("rtcClose")}):this.$store.commit("closeItem",item.guid)}},computed:{historyId:function(){return this.$store.state.historyId},historyList:function(){return this.$store.state.historyList},callUser:function(){return this.$store.state.callUser}}},historyList_component=(__webpack_require__("ooib"),Object(componentNormalizer.a)(message_historyListvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"historyList"},[_c("el-scrollbar",{ref:"scrollbar",staticClass:"main-scroll",attrs:{tag:"div"}},[_c("transition-group",{attrs:{name:"fade-transform"}},_vm._l(_vm.historyList,function(item){return _c("item",{key:item.guid,attrs:{item:item,historyId:_vm.historyId},on:{change:_vm.handleChange,close:_vm.handleClose}})}))],1)],1)},[],!1,null,"fce0a4f2",null));historyList_component.options.__file="index.vue";var historyList=historyList_component.exports,card=__webpack_require__("OVEK"),newGroup_indexvue_type_script_lang_js_={components:{Contacts:__webpack_require__("kA96").a},props:{title:String,isDefault:{type:Array,default:function(){return[]}},groupid:String,groupname:String,visible:Boolean,noName:Boolean},methods:{handleClose:function(){this.$emit("update:visible",!1)}},computed:{activeItem:function(){return this.$store.getters.activeItem}}},index_component=(__webpack_require__("0mCb"),Object(componentNormalizer.a)(newGroup_indexvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.visible&&_vm.activeItem?_c("el-dialog",{attrs:{title:_vm.title,visible:_vm.visible,"show-close":!1,width:"670px","append-to-body":"","close-on-click-modal":"",center:""}},[_c("i",{staticClass:"iconfont icon-close",on:{click:_vm.handleClose}}),_vm._v(" "),_c("contacts",_vm._b({on:{close:_vm.handleClose}},"contacts",_vm.$props,!1))],1):_c("div")},[],!1,null,"850bf04e",null));index_component.options.__file="index.vue";var newGroup_index=index_component.exports,stringify=__webpack_require__("gDS+"),stringify_default=__webpack_require__.n(stringify),lodash=__webpack_require__("LvDl"),singleAvator=__webpack_require__("dTSq"),easemob=__webpack_require__("iwLr"),message_setGroupvue_type_script_lang_js_={components:{SingleAvator:singleAvator.a,NewGroup:newGroup_index,Card:card.a},props:{visible:Boolean},data:function(){return{searchShow:!1,searchValue:"",close:!1,groupname:"",isEdit:!1,newGroupDialog:!1,nodisturb:!1,stick:!1,timer:null,usercode:"",cardDialog:!1,pccUserInfos:[],loading:!1}},watch:{activeItem:{immediate:!0,deep:!0,handler:function(value){value&&"group"===value.type&&(this.groupname=this.itemGroupname,this.nodisturb=value.no_disturb,this.stick=value.istop,this.pccUserInfos=JSON.parse(stringify_default()(value.pccUserInfos)))}}},methods:{showCard:function(usercode){this.usercode=usercode,this.cardDialog=!0},handleClose:function(){var _this=this;this.close=!0,this.$nextTick(function(){_this.timer=setTimeout(function(){_this.close=!1,_this.isEdit=!1,_this.searchShow=!1,clearTimeout(_this.timer),_this.$emit("update:visible",!1)},200)})},findUserlistByKeyword:function(value){var _this2=this;value!==this.searchValue&&(this.searchValue=value,this.loading=!0,actions.m({keyword:value,groupid:this.activeItem.groupid}).then(function(res){200===res.code&&(_this2.pccUserInfos=_this2.searchValue?res.result:JSON.parse(stringify_default()(_this2.activeItem.pccUserInfos))),_this2.loading=!1}).catch(function(_){return _this2.loading=!1}))},handleSearch:function(e){var _this3=this;if(!e.target.value)return this.searchValue="",void(this.pccUserInfos=JSON.parse(stringify_default()(this.activeItem.pccUserInfos)));Object(lodash.debounce)(function(){return _this3.findUserlistByKeyword(e.target.value)},100,{maxWait:500})()},handleClear:function(){this.searchValue="",this.pccUserInfos=JSON.parse(stringify_default()(this.activeItem.pccUserInfos))},handleSearchIcon:function(){var _this4=this;this.searchShow=!this.searchShow,this.$nextTick(function(){_this4.searchShow&&_this4.$refs.searchInput.focus()})},sendGroupMessage:function(groupid,msg,flag){var _this5=this,currentName=this.activeItem.isorg?this.componyName+"."+this.groupname:this.groupname;flag||this.$nextTick(function(){_this5.$store.commit("addItem",extends_default()({},_this5.activeItem,{groupname:currentName,timestamp:+new Date,pccUserInfos:_this5.pccUserInfos,payload:stringify_default()({msg:msg,type:"txt"})}))})},updateChatgroup:function(currentName){var _this6=this,_activeItem=this.activeItem,timestamp=_activeItem.timestamp,groupid=_activeItem.groupid;actions.Z({groupname:currentName,descrption:"群聊",timestamp:timestamp,groupid:groupid}).then(function(res){200===res.code&&_this6.sendGroupMessage(groupid,"群主修改群名称为："+_this6.groupname)})},handleEdit:function(){var _this7=this;this.groupname||!this.isEdit?this.$options.filters.trim(this.groupname)||!this.isEdit?(this.isEdit=!this.isEdit,this.$nextTick(function(){if(_this7.isEdit)_this7.$refs.searchInput.focus();else{var currentName=_this7.activeItem.isorg?_this7.componyName+"."+_this7.groupname:_this7.groupname;if(_this7.activeItem.groupname===currentName)return;easemob.b(_this7.$imConn,_this7.activeItem.groupid,currentName).then(function(res){_this7.updateChatgroup(currentName),_this7.$notify.success({title:"成功",message:"群组名称修改成功"})})}})):this.$notify.error({title:"警告",message:"群组名称不能仅由空格组成"}):this.$notify.error({title:"警告",message:"群组名称不能为空"})},setGroup:function(){actions.U({groupid:this.activeItem.groupid,type:this.activeItem.type,no_disturb:this.nodisturb||!1,istop:this.stick||!1})},nodisturbChange:function(val){var _this8=this;this.$store.commit("updateItem",extends_default()({},this.activeItem,{no_disturb:val})),this.$nextTick(function(){return _this8.setGroup()})},stickChange:function(val){var _this9=this;this.$store.commit("addItem",extends_default()({},this.activeItem,{istop:val})),this.$nextTick(function(){return _this9.setGroup()})},handleAddNew:function(){this.newGroupDialog=!0},handleKicked:function(usercode){var _this10=this,user=this.activeItem.pccUserInfos.find(function(v){return v.usercode===usercode}),index=this.activeItem.pccUserInfos.findIndex(function(v){return v.usercode===usercode}),data={groupId:this.activeItem.groupid,username:user.easemobname};easemob.f(this.$imConn,data.groupId,data.username).then(function(res){actions.j(data.groupId,data.username,"delete",+new Date).then(function(res){200===res.code&&(_this10.$notify.success({title:"成功",message:"成员移出群组成功"}),-1!==index&&_this10.activeItem.pccUserInfos.splice(index,1),_this10.sendGroupMessage(_this10.activeItem.groupid,"群主将 "+user.username+" 移出群聊"))})})},confirmQuit:function(){var _this11=this;this.isQuitWait?this.$notify.warning({title:"警告",message:"正在退出，请不要重复操作"}):this.$msgbox.confirm("退出后不会再接收此群消息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){_this11.activeItem.owner===_this11.userData.easemobname?1<_this11.activeItem.pccUserInfos.length?_this11.handleTransfer():_this11.handleDissolve("退出群组成功"):_this11.handleQuit()})},handleTransfer:function(){var _this12=this,newOwner=this.activeItem.pccUserInfos[1].easemobname;actions.d({groupid:this.activeItem.groupid,newOwner:newOwner,timestamp:+new Date}).then(function(res){200===res.code&&_this12.handleQuit()})},handleQuit:function(){var _this13=this;this.isQuitWait=!0;var guid=this.activeItem.guid;this.activeItem.pccUserInfos.findIndex(function(v){return v.usercode===_this13.userData.usercode});easemob.g(this.$imConn,this.userData.easemobname,this.activeItem.groupid).then(function(_){actions.j(_this13.activeItem.groupid,_this13.userData.easemobname,"quit",+new Date).then(function(res){_this13.isQuitWait=!1,200===res.code&&(_this13.sendGroupMessage(_this13.activeItem.groupid,_this13.userData.username+" 已退出群聊","close"),_this13.$store.commit("closeItem",guid),_this13.$nextTick(function(){_this13.$notify.success({title:"成功",message:"退出群组成功"})}))}).catch(function(_){return _this13.isQuitWait=!1})}).catch(function(_){_this13.chechGroup("退出群组成功"),_this13.isQuitWait=!1})},confirmDissolve:function(){var _this14=this;this.isDissolveWait?this.$notify.warning({title:"警告",message:"正在解散，请不要重复操作"}):this.$msgbox.confirm("解散该群后，所有群成员将失去和群友的联系，同时该群的聊天图片、文件也将被删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){_this14.handleDissolve()}).catch(function(_){})},handleDissolve:function(msg){var _this15=this;this.isDissolveWait=!0,easemob.d(this.$imConn,this.activeItem.groupid).then(function(_){_this15.deleteGroup(msg)}).catch(function(_){return _this15.chechGroup()})},deleteGroup:function(msg){var _this16=this;return actions.i(this.activeItem.groupid).then(function(res){_this16.isDissolveWait=!1,200===res.code&&(_this16.$store.commit("closeItem",_this16.activeItem.guid),_this16.$emit("update:visible",!1),_this16.$notify.success({title:"成功",message:msg||"群组解散成功"}))}).catch(function(_){return _this16.isDissolveWait=!1})},chechGroup:function(msg){var _this17=this;easemob.e(this.$imConn).then(function(res){res.data.map(function(v){return v.groupid}).includes(_this17.activeItem.groupid)||_this17.deleteGroup(msg)})},isDelete:function(item){return item.usercode!==this.userData.usercode&&this.ownerItem&&this.ownerItem.usercode===this.userData.usercode},handleQuery:function(){easemob.h(this.$imConn,this.activeItem.groupid)}},computed:{activeItem:function(){return this.$store.getters.activeItem},isDefault:function(){return this.activeItem.pccUserInfos},userData:function(){return this.$store.state.userData},ownerItem:function(){var _this18=this;return this.activeItem.pccUserInfos.find(function(v){return v.easemobname===_this18.activeItem.owner})},historyList:function(){return this.$store.state.historyList},itemGroupname:function(){return this.$options.filters.currentGroupName(this.activeItem)},componyName:function(){return this.$store.state.componyName}},destroyed:function(){this.close=!1,clearTimeout(this.timer)}},setGroup_component=(__webpack_require__("60WW"),Object(componentNormalizer.a)(message_setGroupvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.visible?_c("div",{class:["setGroup",{closeAni:_vm.close}]},[_c("card",{attrs:{usercode:_vm.usercode,"card-dialog":_vm.cardDialog},on:{"update:cardDialog":function($event){_vm.cardDialog=$event},close:_vm.handleClose}}),_vm._v(" "),_c("div",{staticClass:"modal",on:{click:function($event){return $event.stopPropagation(),$event.target!==$event.currentTarget?null:_vm.handleClose($event)}}}),_vm._v(" "),_c("div",{staticClass:"container"},[_c("div",{staticClass:"header"},[_c("i",{staticClass:"iconfont icon-close",on:{click:function($event){return $event.stopPropagation(),$event.target!==$event.currentTarget?null:_vm.handleClose($event)}}}),_vm._v(" "),_c("div",[_vm._v("群设置")])]),_vm._v(" "),_c("div",{staticClass:"main"},[_c("el-scrollbar",{ref:"scrollbar",staticClass:"main-scroll",attrs:{tag:"div"}},[_c("div",{staticClass:"info item"},[_c("span",[_vm._v("群名称：")]),_vm._v(" "),_c("span",{directives:[{name:"show",rawName:"v-show",value:!_vm.isEdit,expression:"!isEdit"}]},[_vm._v(_vm._s(_vm.itemGroupname))]),_vm._v(" "),_c("el-input",{directives:[{name:"show",rawName:"v-show",value:_vm.isEdit,expression:"isEdit"}],staticStyle:{width:"120px"},attrs:{size:"mini",maxlength:30,"auto-complete":"off"},nativeOn:{keyup:[function($event){return"button"in $event||!_vm._k($event.keyCode,"enter",13,$event.key,"Enter")?_vm.handleEdit($event):null},function($event){if(!("button"in $event)&&_vm._k($event.keyCode,"esc",27,$event.key,"Escape"))return null;_vm.isEdit=!1}]},model:{value:_vm.groupname,callback:function($$v){_vm.groupname=$$v},expression:"groupname"}}),_vm._v(" "),_vm.ownerItem&&_vm.ownerItem.usercode===_vm.userData.usercode?_c("span",{staticClass:"editGroupname",on:{click:_vm.handleEdit}},[_vm._v(_vm._s(_vm.isEdit?"确认":"编辑"))]):_vm._e()],1),_vm._v(" "),_c("div",{staticClass:"info item"},[_c("span",[_vm._v("群主：")]),_vm._v(" "),_c("span",[_vm._v(_vm._s(_vm.ownerItem&&_vm.ownerItem.username))])]),_vm._v(" "),_c("div",{staticClass:"info switch"},[_c("span",[_vm._v("消息免打扰：")]),_vm._v(" "),_c("el-switch",{attrs:{"active-color":"#E8E8E9","inactive-color":"#E8E8E9"},on:{change:_vm.nodisturbChange},model:{value:_vm.nodisturb,callback:function($$v){_vm.nodisturb=$$v},expression:"nodisturb"}})],1),_vm._v(" "),_c("div",{staticClass:"info switch"},[_c("span",[_vm._v("群置顶：")]),_vm._v(" "),_c("el-switch",{attrs:{"active-color":"#E8E8E9","inactive-color":"#E8E8E9"},on:{change:_vm.stickChange},model:{value:_vm.stick,callback:function($$v){_vm.stick=$$v},expression:"stick"}})],1),_vm._v(" "),_c("div",{staticClass:"memberBox"},[_c("div",{staticClass:"searchBox"},[_c("div",[_c("span",[_vm._v("群成员："+_vm._s(_vm.activeItem.pccUserInfos.length)+"人")]),_vm._v(" "),_vm.activeItem.isorg&&_vm.ownerItem.usercode!==_vm.userData.usercode?_vm._e():_c("div",{staticClass:"addNew",on:{click:_vm.handleAddNew}},[_c("span",[_vm._v("+")]),_vm._v("添加新成员\n              ")])]),_vm._v(" "),_c("el-input",{directives:[{name:"show",rawName:"v-show",value:_vm.searchShow,expression:"searchShow"}],ref:"searchInput",staticClass:"searchInput",attrs:{placeholder:"搜索群成员",value:_vm.searchValue,size:"small",clearable:"","auto-complete":"off"},on:{clear:_vm.handleClear},nativeOn:{input:function($event){return _vm.handleSearch($event)},keyup:function($event){if(!("button"in $event)&&_vm._k($event.keyCode,"esc",27,$event.key,"Escape"))return null;_vm.searchShow=!1}}}),_vm._v(" "),_c("i",{staticClass:"iconfont icon-search",on:{click:function($event){return $event.stopPropagation(),$event.target!==$event.currentTarget?null:_vm.handleSearchIcon($event)}}})],1),_vm._v(" "),_c("div",{directives:[{name:"loading",rawName:"v-loading",value:_vm.loading,expression:"loading"}],staticClass:"member"},_vm._l(_vm.pccUserInfos,function(item){return _c("SingleAvator",{key:item.usercode,staticClass:"item",attrs:{nickname:item.username,usercode:item.usercode,avator:item.headimg,direction:"vertical",circle:"","is-delete":_vm.isDelete(item)},on:{kicked:_vm.handleKicked},nativeOn:{click:function($event){_vm.showCard(item.usercode)}}})}))])])],1),_vm._v(" "),_c("div",{staticClass:"footer"},[_c("el-button",{attrs:{type:"primary",round:""},on:{click:_vm.confirmQuit}},[_vm._v("退出群聊")]),_vm._v(" "),_vm.ownerItem&&_vm.ownerItem.usercode===_vm.userData.usercode&&!_vm.activeItem.isorg?_c("div",{staticClass:"exit",on:{click:_vm.confirmDissolve}},[_vm._v("解散群聊")]):_vm._e()],1),_vm._v(" "),_c("new-group",{attrs:{visible:_vm.newGroupDialog,title:"添加新成员","is-default":_vm.isDefault,groupid:_vm.activeItem.groupid,groupname:_vm.itemGroupname,"no-name":""},on:{"update:visible":function($event){_vm.newGroupDialog=$event}}})],1)],1):_c("div")},[],!1,null,"6b0adaff",null));setGroup_component.options.__file="index.vue";var message_setGroup=setGroup_component.exports,message_messageHeadervue_type_script_lang_js_={components:{Avator:avator,Card:card.a,NewGroup:newGroup_index,SetGroup:message_setGroup},props:{activeItem:Object},data:function(){return{visible:!1,cardDialog:!1,setGroupDialog:!1}},methods:{handleOpen:function(){this.visible=!0},handleSetOpen:function(){this.setGroupDialog=!0},showCard:function(){this.usercode&&(this.cardDialog=!0)}},computed:{usercode:function(){return"person"===this.activeItem.type?this.activeItem.usercode:""},userData:function(){return this.$store.state.userData},isDefault:function(){return[this.activeItem,this.userData]},isChat:function(){return"person"===this.activeItem.type||"group"===this.activeItem.type},name:function(){switch(this.activeItem.type){case"person":return this.activeItem.username;case"group":return this.$options.filters.currentGroupName(this.activeItem);default:return this.activeItem.modlename}}}},messageHeader_component=(__webpack_require__("vIMT"),Object(componentNormalizer.a)(message_messageHeadervue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.activeItem?_c("div",{class:["messageHeader",{chat:_vm.isChat}]},[_c("div",{staticClass:"baseinfo"},[_c("avator",{attrs:{item:_vm.activeItem},nativeOn:{click:function($event){return _vm.showCard($event)}}}),_vm._v(" "),_c("div",{staticClass:"right"},[_c("div",{staticClass:"nickname"},[_vm._v(_vm._s(_vm.name))]),_vm._v(" "),_vm.activeItem.summary||_vm.activeItem.isorg&&_vm.activeItem.groupname?_c("div",{staticClass:"message"},[_vm._v(_vm._s(_vm.activeItem.summary||_vm.activeItem.groupname.split(".")[0]))]):_vm._e()])],1),_vm._v(" "),_c("card",{attrs:{usercode:_vm.usercode,"card-dialog":_vm.cardDialog},on:{"update:cardDialog":function($event){_vm.cardDialog=$event}}}),_vm._v(" "),_c("new-group",{attrs:{visible:_vm.visible,title:"添加新成员","is-default":_vm.isDefault},on:{"update:visible":function($event){_vm.visible=$event}}}),_vm._v(" "),_c("set-group",{attrs:{visible:_vm.setGroupDialog},on:{"update:visible":function($event){_vm.setGroupDialog=$event}}}),_vm._v(" "),_c("div",["person"===_vm.activeItem.type&&_vm.activeItem.usercode!==_vm.userData.usercode?_c("el-tooltip",{attrs:{effect:"dark","visible-arrow":!1,enterable:!1,content:"添加新成员",placement:"bottom-end",offset:16}},[_c("div",{staticClass:"iconbox"},[_c("i",{staticClass:"iconfont icon-add",on:{click:function($event){return $event.stopPropagation(),_vm.handleOpen($event)}}})])]):_vm._e(),_vm._v(" "),"group"===_vm.activeItem.type?_c("el-tooltip",{attrs:{effect:"dark","visible-arrow":!1,enterable:!1,content:"群设置",placement:"bottom-end",offset:16}},[_c("i",{staticClass:"iconfont icon-group",on:{click:function($event){return $event.stopPropagation(),_vm.handleSetOpen($event)}}})]):_vm._e()],1)],1):_c("div")},[],!1,null,"633cbc9f",null));messageHeader_component.options.__file="index.vue";var messageHeader=messageHeader_component.exports,keys=__webpack_require__("GQeE"),keys_default=__webpack_require__.n(keys),groupAvator=__webpack_require__("pThU"),transmit_allContactsvue_type_script_lang_js_={components:{SingleAvator:singleAvator.a,GroupAvator:groupAvator.a},props:{datas:Array,checked:Array},data:function(){return{checkAll:!1,isIndeterminate:!1}},watch:{checked:{immediate:!0,handler:function(value){this.checkStatus()}}},methods:{handleCheckAllChange:function(val){this.isIndeterminate=!1,val?this.$emit("update:checked",JSON.parse(stringify_default()(this.datas))):this.$emit("update:checked",[])},checkStatus:function(){var checked=this.checked,datas=this.datas;if(datas.length){var checkAll=datas.every(function(v){return checked.map(function(c){return c.usercode}).includes(v.usercode)&&checked.map(function(c){return c.groupid}).includes(v.groupid)});if(this.checkAll=checkAll)this.isIndeterminate=!1;else{var checkDep=datas.some(function(v){return checked.map(function(c){return c.usercode}).includes(v.usercode)||checked.map(function(c){return c.groupid}).includes(v.groupid)});this.isIndeterminate=checkDep}}},handleCheckedPersonChange:function(value){var checkedPersons=this.checked.slice(),index=checkedPersons.findIndex(function(c){return c.usercode===value.usercode});-1===index?checkedPersons.push(value):checkedPersons.splice(index,1),this.$emit("update:checked",checkedPersons)},handleCheckedGroupChange:function(value){var checkedGroups=this.checked.slice(),index=checkedGroups.findIndex(function(c){return c.groupid===value.groupid});-1===index?checkedGroups.push(value):checkedGroups.splice(index,1),this.$emit("update:checked",checkedGroups)}}},allContacts_component=(__webpack_require__("+XGd"),Object(componentNormalizer.a)(transmit_allContactsvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"allContacts"},[_c("div",{staticClass:"title"},[_vm._v("最近联系人：")]),_vm._v(" "),_c("div",{staticClass:"box"},[_c("el-scrollbar",{ref:"scrollbar",staticClass:"main-scroll",attrs:{tag:"div"}},[_vm.datas.length?_c("el-checkbox",{staticClass:"checkAll",attrs:{indeterminate:_vm.isIndeterminate},on:{change:_vm.handleCheckAllChange},model:{value:_vm.checkAll,callback:function($$v){_vm.checkAll=$$v},expression:"checkAll"}},[_vm._v("\n        全选\n      ")]):_c("div",{staticClass:"no-contact"},[_vm._v("暂无最近联系人 :(")]),_vm._v(" "),_c("div",{staticClass:"person"},[_vm._l(_vm.datas.filter(function(v){return v.usercode}),function(item){return _c("single-avator",{key:item.usercode,staticClass:"checkbox personItem",attrs:{nickname:item.username,usercode:item.usercode,avator:item.headimg,checks:_vm.checked.map(function(v){return v.usercode}),circle:"",checkable:""},on:{click:function($event){_vm.handleCheckedPersonChange(item)}}})}),_vm._v(" "),_vm._l(_vm.datas.filter(function(v){return v.groupid}),function(item){return _c("group-avator",{key:item.groupid,staticClass:"checkbox",attrs:{item:item,checks:_vm.checked.map(function(v){return v.usercode}),checkable:""},on:{click:function($event){_vm.handleCheckedGroupChange(item)}}})})],2)],1)],1)])},[],!1,null,"c4a36512",null));allContacts_component.options.__file="index.vue";var allContacts=allContacts_component.exports,transmit_newContactsvue_type_script_lang_js_={components:{SingleAvator:singleAvator.a,GroupAvator:groupAvator.a},props:{datas:Array,checked:Array},data:function(){return{searchValue:"",placeholder:"搜索联系人/群组",isSearch:!1,searchLists:{users:[],groups:[]},loading:!1}},mounted:function(){var _this=this;this.$nextTick(function(){_this.$refs.search.focus()})},methods:{handleBlur:function(){var _this2=this;setTimeout(function(){_this2.searchValue="",_this2.isSearch=!1,_this2.searchLists=_this2.initLists},500)},findGroupinfoByKey:function(value){var _this3=this;value!==this.searchValue&&(value?(this.searchValue=value,actions.l({keyword:value}).then(function(res){var lists=JSON.parse(stringify_default()(_this3.initLists));200===res.code&&(res.result.map(function(v){v.groupid?lists.groups.push(v):v.usercode&&lists.users.push(v)}),_this3.searchLists=lists,_this3.loading=!1)})):this.searchValue="")},handleSearch:function(e){var _this4=this;this.loading=!0,Object(lodash.debounce)(function(){return _this4.findGroupinfoByKey(e.target.value)},100,{maxWait:500})()},handleKeyDown:function(event){if(event.stopPropagation(),this.total&&!this.searchValue&&8===event.keyCode){var checked=this.checked,tag=checked[checked.length-1];this.handleClose(tag)}},handleAdd:function(item){var checked=this.checked.slice();-1===checked.findIndex(function(v){return item.usercode&&v.usercode===item.usercode||item.groupid&&v.groupid===item.groupid})?checked.push(item):this.$notify.warning({title:"警告",message:"不能添加相同的联系人"}),this.$refs.search.focus(),this.$emit("update:checked",checked)},handleClose:function(tag){var checked=this.checked.slice(),index=checked.findIndex(function(v){return tag.usercode?v.usercode===tag.usercode:v.groupid===tag.groupid});-1!==index&&checked.splice(index,1),this.$emit("update:checked",checked)},tagname:function(tag){return tag.username?tag.username:this.$options.filters.currentGroupName(tag)}},computed:{total:function(){var groups=this.checked.filter(function(v){return v.groupid}),memberCounts=0;return groups.length&&(memberCounts=groups.map(function(v){return v.pccUserInfos.length}).reduce(function(prev,next){return prev+next})),memberCounts+this.checked.filter(function(v){return v.usercode}).length},initLists:function(){return{users:[],groups:[]}}}},newContacts_component=(__webpack_require__("aB95"),__webpack_require__("8ea8"),Object(componentNormalizer.a)(transmit_newContactsvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"newContacts"},[_c("div",{staticClass:"title"},[_c("div",[_vm._v("转发给：")]),_vm._v(" "),_c("div",[_vm._v("已选 "+_vm._s(_vm.total)+"/50 人")])]),_vm._v(" "),_c("div",{class:["box",{search:_vm.isSearch}]},[_c("el-scrollbar",{ref:"scrollbar",staticClass:"main-scroll",attrs:{tag:"div"}},[_vm._l(_vm.checked,function(tag){return _c("el-tag",{key:tag.usercode||tag.groupid,attrs:{"disable-transitions":!1,closable:""},on:{close:function($event){_vm.handleClose(tag)}}},[_vm._v("\n        "+_vm._s(_vm.tagname(tag))+"\n      ")])}),_vm._v(" "),_c("el-input",{ref:"search",staticClass:"contactSearch",attrs:{value:_vm.searchValue,size:"small",placeholder:_vm.searchValue||_vm.total?"":_vm.placeholder,"auto-complete":"off"},on:{focus:function($event){_vm.isSearch=!0},blur:_vm.handleBlur},nativeOn:{input:function($event){return _vm.handleSearch($event)},keydown:function($event){return _vm.handleKeyDown($event)}}}),_vm._v(" "),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.searchValue,expression:"searchValue"},{name:"loading",rawName:"v-loading",value:_vm.loading,expression:"loading"}],staticClass:"searchMask"},[_c("div",{directives:[{name:"show",rawName:"v-show",value:!_vm.searchLists.users.length&&!_vm.searchLists.groups.length&&!_vm.loading,expression:"!searchLists.users.length && !searchLists.groups.length && !loading"}],staticClass:"nothing"},[_vm._v("暂无匹配联系人/群组")]),_vm._v(" "),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.searchLists.users.length,expression:"searchLists.users.length"}],staticClass:"title"},[_vm._v("单位联系人")]),_vm._v(" "),_vm._l(_vm.searchLists.users,function(item){return _c("single-avator",{key:item.usercode,staticClass:"item personItem",attrs:{nickname:item.username,usercode:item.usercode,avator:item.headimg,circle:"",checkable:""},nativeOn:{click:function($event){_vm.handleAdd(item)}}})}),_vm._v(" "),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.searchLists.groups.length,expression:"searchLists.groups.length"}],staticClass:"title"},[_vm._v("群组")]),_vm._v(" "),_vm._l(_vm.searchLists.groups,function(group){return _c("group-avator",{key:group.groupid,staticClass:"item groupItem",attrs:{item:group},nativeOn:{click:function($event){_vm.handleAdd(group)}}})})],2)],2)],1)])},[],!1,null,"f54192e6",null));newContacts_component.options.__file="index.vue";var transmit_contactsvue_type_script_lang_js_={components:{AllContacts:allContacts,NewContacts:newContacts_component.exports},props:{message:Object},data:function(){return{datas:[],checked:[],loading:!1}},created:function(){var _this=this;this.loading=!0,actions.E().then(function(res){200===res.code&&(_this.datas=res.result),_this.loading=!1}).catch(function(_){return _this.loading=!1})},methods:{saveMessage:function(data){return actions.T(data).then(function(res){return res})},handleTypeMessage:function(item,data){var _this2=this,msg_id=this.$imConn.getUniqueId(),typeMessage=void 0;typeMessage="txt"===data.msg_type?easemob.m(this.$imConn,extends_default()({},data,{msg_id:msg_id})):"img"===data.msg_type?easemob.l(this.$imConn,extends_default()({},data,{msg_id:msg_id}),{}):easemob.k(this.$imConn,extends_default()({},data,{msg_id:msg_id}),{}),this.saveMessage(extends_default()({},data,{msg_id:msg_id})).then(function(res){res&&typeMessage.then(function(_){actions.R(data.type,msg_id,!0).then(function(res){200===res.code&&actions.v().then(function(res){res&&_this2.$store.commit("setHistoryList",res)})}),item.usercode&&item.usercode===_this2.activeItem.usercode&&_this2.$store.commit("addMessage",extends_default()({},data,{msg_id:msg_id})),item.groupid&&item.groupid===_this2.activeItem.groupid&&_this2.$store.commit("addMessage",extends_default()({},data,{msg_id:msg_id})),_this2.$emit("close")})})},sendPersonMsg:function(item,defaultData){var data=extends_default()({},defaultData,{to_user:item.easemobname,chat_type:"chat",type:"person",easemobname:item.easemobname,chatType:"singleChat"});this.handleTypeMessage(item,data)},sendGroupMsg:function(item,defaultData){var data=extends_default()({},defaultData,{to_user:item.groupid,chat_type:"groupchat",type:"group",easemobname:item.groupid,chatType:"chatRoom"});this.handleTypeMessage(item,data)},handleAdd:function(){var _this3=this,payload=this.payload,defaultData={timestamp:+new Date,from_user:this.easemobname,msg_type:payload.type,payload:stringify_default()(payload),modle_code:1,isrecord:!0};this.checked.map(function(v){v.usercode?_this3.sendPersonMsg(v,defaultData):_this3.sendGroupMsg(v,defaultData)})}},computed:{payload:function(){return JSON.parse(this.message.payload)},activeItem:function(){return this.$store.getters.activeItem},easemobname:function(){return this.$store.state.userData.easemobname}}},contacts_component=(__webpack_require__("7Ctf"),Object(componentNormalizer.a)(transmit_contactsvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{directives:[{name:"loading",rawName:"v-loading",value:_vm.loading,expression:"loading"}]},[_c("div",{staticClass:"main"},[_c("all-contacts",{attrs:{datas:_vm.datas,checked:_vm.checked},on:{"update:checked":function($event){_vm.checked=$event}}}),_vm._v(" "),_c("new-contacts",{attrs:{datas:_vm.datas,checked:_vm.checked},on:{"update:checked":function($event){_vm.checked=$event}}})],1),_vm._v(" "),_c("div",{staticClass:"dialog-footer"},[_c("el-button",{attrs:{type:"primary",round:""},nativeOn:{click:function($event){return _vm.handleAdd($event)}}},[_vm._v("确 定")])],1)])},[],!1,null,"052738c6",null));contacts_component.options.__file="index.vue";var message_transmitvue_type_script_lang_js_={components:{Contacts:contacts_component.exports},props:{visible:Boolean,message:Object},methods:{handleClose:function(){this.$emit("update:visible",!1)}}},transmit_component=(__webpack_require__("zfbk"),Object(componentNormalizer.a)(message_transmitvue_type_script_lang_js_,function(){var _h=this.$createElement,_c=this._self._c||_h;return this.visible?_c("el-dialog",{attrs:{title:"转发消息",visible:this.visible,"show-close":!1,width:"670px","append-to-body":"","close-on-click-modal":"",center:""}},[_c("i",{staticClass:"iconfont icon-close",on:{click:this.handleClose}}),this._v(" "),_c("contacts",{attrs:{message:this.message},on:{close:this.handleClose}})],1):_c("div")},[],!1,null,"795a3fd1",null));transmit_component.options.__file="index.vue";var transmit=transmit_component.exports,message_messageViewvue_type_script_lang_js_={components:{UserDialog:__webpack_require__("b/pT").a,Avator:avator,Card:card.a,Transmit:transmit},props:{activeItem:Object},data:function(){return{show:"",usercode:"",popover:!1,cardDialog:!1,left:0,bottom:0,pageIndex:1,transmitDialog:!1,msg:null,visible:!1,imgSrc:"",objectURL:"",isPaying:"",width:""}},watch:{show:function(val,oldval){val!==oldval&&(this.popover=!1)},message:{immediate:!0,handler:function(value,oldval){var _this=this;this.$nextTick(function(){if(value.length&&!(oldval&&value.length<oldval.length)&&_this.$refs.items.length){var msg_end=_this.$refs.items[value.length-1];msg_end&&msg_end.scrollIntoView()}})}},activeItem:{immediate:!0,handler:function(value){var _this2=this;this.$nextTick(function(){if(_this2.pageIndex=1,_this2.isPaying="",_this2.message.length&&_this2.$refs.items.length){var msg_end=_this2.$refs.items[_this2.message.length-1];msg_end&&msg_end.scrollIntoView()}})}}},mounted:function(){var _this3=this;this.$nextTick(function(){_this3.$refs.aud.onended=function(){this.objectURL&&(this.isPaying="",this.objectURL="")}.bind(_this3)})},methods:{handleMagnify:function(payload){var _this4=this;this.imgSrc=payload.url,this.width=payload.size.width+"px",this.$nextTick(function(){_this4.visible=!0})},isSelf:function(from_user){return from_user===this.userData.easemobname},currentItem:function(item){var data=void 0;if(item.from_user===this.userData.easemobname)data=extends_default()({},this.userData,{type:"person"});else if("person"===item.type)data=extends_default()({},this.activeItem,{type:"person"});else if("group"===item.type){var currentItem=this.activeItem.pccUserInfos.find(function(v){return v.easemobname===item.from_user});data=currentItem?extends_default()({},currentItem,{type:"person"}):{usercode:item.usercode,compid:item.compid,type:"person"}}else data=extends_default()({},this.activeItem,{type:item.type,payload:this.currentPayload(item.payload)});return data},handleMore:function(){var _this5=this;this.$store.commit("setMessageWait",!0),this.pageIndex+=1,actions.w({type:this.activeItem.type,fromcode:this.activeItem.targetuser,start:this.pageIndex,pagesize:20}).then(function(res){res&&200===res.code&&_this5.$store.commit("moreMessage",res.result.list),_this5.$store.commit("setMessageWait",!1)}).catch(function(_){return _this5.$store.commit("setMessageWait",!1)})},showCard:function(item){var _this6=this;"app"!==item.type&&"system"!==item.type&&(this.usercode=item.usercode,this.$nextTick(function(){_this6.cardDialog=!0}))},handleOptions:function(e){var _this7=this;this.left=event.clientX-60,this.bottom=document.documentElement.clientHeight-event.clientY+20,this.$nextTick(function(){_this7.popover=!0})},handleOut:function(){var _this8=this;this.show="",this.$nextTick(function(){_this8.show||(_this8.popover=!1)})},handleTransmit:function(msg){this.msg=msg,this.transmitDialog=!0,this.popover=!1},handleDMessage:function(data){var _this9=this,timestamp=this.activeItem.timestamp;actions.k({msg_id:data.msg_id,targetuser:this.activeItem.targetuser,type:this.activeItem.type,payload:this.activeItem.payload,mesg_type:this.activeItem.mesg_type,timestamp:timestamp}).then(function(res){200===res.code&&(data.msg_id===_this9.message[_this9.message.length-1].msg_id&&_this9.$store.commit("updateItem",extends_default()({},_this9.activeItem,{timestamp:_this9.message[_this9.message.length-2]?_this9.message[_this9.message.length-2].timestamp:timestamp,payload:_this9.message[_this9.message.length-2]?_this9.message[_this9.message.length-2].payload:stringify_default()({msg:"",type:"txt"})})),_this9.$nextTick(function(){_this9.$store.commit("removeMessage",data.msg_id)})),_this9.popover=!1})},iconfile:function(name){var type=this.iconType(name);return this.$options.filters.currentFileIcon(type)},iconType:function(name){var arr=name.split(".");return arr[arr.length-1]},handleLink:function(url){if(url){var newPage=window.open();actions.L(url).then(function(res){if(200===res.code){var _url=res.result.split("redirect:")[1];newPage.location.href=_url}else newPage.close()}).catch(function(_){return newPage.close()})}},currentPayload:function(item){return JSON.parse(item)},streamIcon:function(type){var icon=void 0;switch(type){case"VOICE":icon="icon-call";break;case"VIDEO":icon="icon-video-call"}return icon},handleLaunch:function(type){1<keys_default()(this.callUser).length?this.$notify.warning({title:"警告",message:"你还有未结束的通话！"}):(this.$store.commit("setCallUser",extends_default()({},this.activeItem,{originator:this.username,loading:!0,waitTime:!0})),this.$rtcCall.caller=this.easemobname,"语音"===type?this.$rtcCall.makeVoiceCall(this.activeItem.targetuser):this.$rtcCall.makeVideoCall(this.activeItem.targetuser))},handleAudio:function(url,item){var _this10=this;if(this.isPaying===item.msg_id)return this.isPaying="",void(this.objectURL="");var urls=url.split(".");"mp3"===urls[urls.length-1].toLowerCase()?(this.isPaying=item.msg_id,this.objectURL=url,item.isread||this.isSelf(item.from_user)||actions.I({msg_id:item.msg_id,timestamp:item.timestamp,easemobname:this.userData.easemobname,type:item.type}).then(function(res){_this10.$store.commit("setMessage",extends_default()({},item,{isread:!0}))})):this.$notify.error({title:"错误",message:"不支持当前格式的音频"})},streamText:function(type){var text=void 0;switch(type){case"VOICE":text="语音";break;case"VIDEO":text="视频"}return text}},computed:{message:function(){return this.$store.state.message},userData:function(){return this.$store.state.userData},totalPage:function(){return this.$store.state.totalPage},messageWait:function(){return this.$store.state.messageWait},callUser:function(){return this.$store.state.callUser},easemobname:function(){return this.$store.state.userData.easemobname},username:function(){return this.$store.state.userData.username},notGroupUser:function(){return this.$store.state.notGroupUser}}},messageView_component=(__webpack_require__("MKW7"),__webpack_require__("r+yn"),Object(componentNormalizer.a)(message_messageViewvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"meaasageView"},[_c("card",{attrs:{usercode:_vm.usercode,"card-dialog":_vm.cardDialog},on:{"update:cardDialog":function($event){_vm.cardDialog=$event}}}),_vm._v(" "),_c("audio",{ref:"aud",attrs:{src:""+_vm.objectURL,autoplay:""}}),_vm._v(" "),_c("user-dialog",{attrs:{visible:_vm.visible,ele:"magnify-img","img-src":_vm.imgSrc,width:_vm.width,"custom-class":"magnify"},on:{"update:visible":function($event){_vm.visible=$event}}}),_vm._v(" "),_c("transmit",{attrs:{visible:_vm.transmitDialog,message:_vm.msg},on:{"update:visible":function($event){_vm.transmitDialog=$event}}}),_vm._v(" "),_c("el-scrollbar",{ref:"scrollbar",staticClass:"main-scroll",attrs:{"wrap-class":"main-scroll__wrapper",tag:"div"}},[_vm.pageIndex<_vm.totalPage||_vm.messageWait?_c("div",{directives:[{name:"loading",rawName:"v-loading",value:_vm.messageWait,expression:"messageWait"}],staticClass:"checkmore",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"},on:{click:_vm.handleMore}},[_c("i",{directives:[{name:"show",rawName:"v-show",value:!_vm.messageWait,expression:"!messageWait"}],staticClass:"iconfont icon-time"}),_vm._v(" "),_c("span",{directives:[{name:"show",rawName:"v-show",value:!_vm.messageWait,expression:"!messageWait"}],staticClass:"text"},[_vm._v("查看更多消息")])]):_vm._e(),_vm._v(" "),_vm._l(_vm.message.filter(function(v){return v.payload}),function(item){return _c("div",{key:item.msg_id,ref:"items",refInFor:!0,staticClass:"items",on:{mouseenter:function($event){$event.stopPropagation(),_vm.show=item.msg_id},mouseleave:function($event){return $event.stopPropagation(),_vm.handleOut($event)}}},[item.isrecord?_c("div",{staticClass:"timenode"},[_vm._v(_vm._s(_vm.$options.filters.timestampToMessage(item.timestamp)))]):_vm._e(),_vm._v(" "),"systemadmin"===item.from_user&&"group"===item.type?_c("div",{staticClass:"systemTips"},[_vm._v(_vm._s(_vm.currentPayload(item.payload).msg))]):_c("div",{class:["item",{isSelf:_vm.isSelf(item.from_user)}]},[_c("avator",{attrs:{item:_vm.currentItem(item),"is-message":""},nativeOn:{click:function($event){_vm.showCard(_vm.currentItem(item))}}}),_vm._v(" "),_c("div",{staticClass:"details"},[_c("div",{staticClass:"time"},[_c("span",{directives:[{name:"show",rawName:"v-show",value:_vm.show===item.msg_id,expression:"show === item.msg_id"}]},[_vm._v(_vm._s(_vm.$options.filters.timestampToMessage(item.timestamp,!0)))])]),_vm._v(" "),"group"===_vm.activeItem.type&&item.from_user!==_vm.userData.easemobname&&_vm.show!==item.msg_id?_c("div",{staticClass:"username"},[_vm._v(_vm._s(_vm.currentItem(item).username||_vm.notGroupUser.find(function(v){return v.easemobname===item.from_user})&&_vm.notGroupUser.find(function(v){return v.easemobname===item.from_user}).username))]):_vm._e(),_vm._v(" "),"app"===_vm.activeItem.type&&_vm.show!==item.msg_id?_c("div",{staticClass:"appname"},[_vm._v(_vm._s(_vm.currentPayload(_vm.currentPayload(item.payload).msg).appname))]):_vm._e(),_vm._v(" "),_c("div",{staticClass:"message"},[_vm.currentPayload(item.payload).ext&&_vm.currentPayload(item.payload).ext.streamType?_c("div",{class:["rtc-default","rtc-"+_vm.currentPayload(item.payload).ext.reason],on:{click:function($event){_vm.handleLaunch(_vm.streamText(_vm.currentPayload(item.payload).ext.streamType))}}},[_c("i",{class:["iconfont",_vm.streamIcon(_vm.currentPayload(item.payload).ext.streamType)]}),_vm._v(" "),_c("span",[_vm._v(_vm._s(_vm.show===item.msg_id?"发起"+_vm.streamText(_vm.currentPayload(item.payload).ext.streamType)+"通话":_vm.$options.filters.rtcMessage(item,{username:_vm.currentPayload(item.payload).ext.originator})))])]):"txt"===_vm.currentPayload(item.payload).type?_c("pre",[_vm._v(_vm._s(_vm.currentPayload(item.payload).msg))]):"img"===_vm.currentPayload(item.payload).type?_c("img",{staticClass:"picture",attrs:{src:""+_vm.currentPayload(item.payload).url},on:{dblclick:function($event){_vm.handleMagnify(_vm.currentPayload(item.payload))}}}):"audio"===_vm.currentPayload(item.payload).type?_c("div",{class:["audio",{redPoint:!item.isread&&!_vm.isSelf(item.from_user)}],on:{click:function($event){_vm.handleAudio(_vm.currentPayload(item.payload).url,item)}}},[_c("span",{staticClass:"length"},[_vm._v(_vm._s(_vm.currentPayload(item.payload).length)+"''")]),_vm._v(" "),_c("i",{class:["audio-wifi",{paying:_vm.isPaying===item.msg_id}]})]):"app"===item.type||"system"===item.type?_c("div",[_c("span",{staticClass:"app-content"},[_vm._v(_vm._s(_vm.currentPayload(_vm.currentPayload(item.payload).msg).content))]),_vm._v(" "),_vm.currentPayload(_vm.currentPayload(item.payload).msg).action&&"no"!==_vm.currentPayload(_vm.currentPayload(item.payload).msg).action?_c("div",{staticClass:"view-details",on:{click:function($event){_vm.handleLink(_vm.currentPayload(_vm.currentPayload(item.payload).msg).pcurl)}}},[_vm._v(_vm._s(_vm.currentPayload(_vm.currentPayload(item.payload).msg).action))]):_vm._e()]):_c("div",{staticClass:"filesbox"},[_c("div",{staticClass:"files",attrs:{title:JSON.parse(item.payload).filename}},[_c("i",{class:["iconfont",_vm.iconfile(JSON.parse(item.payload).filename)]}),_vm._v(" "),_c("div",{staticClass:"infos"},[_c("div",{staticClass:"filename"},[_c("span",{staticClass:"f-name"},[_vm._v(_vm._s(JSON.parse(item.payload).filename.slice(0,"-"+(_vm.iconType(JSON.parse(item.payload).filename).length+1))))]),_vm._v(" "),_c("span",{staticClass:"f-type"},[_vm._v("."+_vm._s(_vm.iconType(JSON.parse(item.payload).filename)))])]),_vm._v(" "),_c("span",{staticClass:"filesize"},[_vm._v(_vm._s(_vm.$options.filters.isFilesize(JSON.parse(item.payload).file_length)))])])]),_vm._v(" "),_c("a",{staticClass:"downing",attrs:{href:JSON.parse(item.payload).url,download:JSON.parse(item.payload).filename}},[_c("i",{staticClass:"iconfont icon-xiazai"}),_vm._v("\n                下载\n              ")])]),_vm._v(" "),_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.show===item.msg_id,expression:"show === item.msg_id"}],staticClass:"dot",on:{click:function($event){return $event.stopPropagation(),_vm.handleOptions($event)}}},[_c("div",{directives:[{name:"show",rawName:"v-show",value:_vm.popover,expression:"popover"}],staticClass:"dotPopover",style:{left:_vm.left+"px",bottom:_vm.bottom+"px"}},["person"===item.type&&!_vm.currentPayload(item.payload).ext||"group"===item.type?_c("div",{staticClass:"option",on:{click:function($event){$event.stopPropagation(),_vm.handleTransmit(item)}}},[_vm._v("转发")]):_vm._e(),_vm._v(" "),_c("div",{staticClass:"option",on:{click:function($event){$event.stopPropagation(),_vm.handleDMessage(item)}}},[_vm._v("删除")])])])])])],1)])})],2)],1)},[],!1,null,"0818febe",null));messageView_component.options.__file="index.vue";var messageView=messageView_component.exports,message_filesListvue_type_script_lang_js_={props:{visible:Boolean,files:[Array,FileList],dom:[String,HTMLInputElement]},data:function(){return{currentFiles:[],successFiles:[],loading:!1,isLt10M:10485760}},watch:{files:{immediate:!0,handler:function(value){this.successFiles=[],this.loading=!1,value.length&&(this.currentFiles=[].slice.call(value))}}},methods:{saveMessage:function(data){var _this2=this,prevTimestamp=this.message.length?this.message[this.message.length-1].timestamp:"",isrecord=!prevTimestamp||3e5<data.timestamp-prevTimestamp;return this.$store.commit("addMessage",extends_default()({},data,{isrecord:isrecord})),actions.T(extends_default()({},data,{isrecord:isrecord})).then(function(res){if(200===res.code){if(_this2.$store.commit("updateItem",extends_default()({},_this2.activeItem,{timestamp:data.timestamp,payload:data.payload})),_this2.successFiles.length>=_this2.currentFiles.length){var errLength=_this2.successFiles.filter(function(v){return!v.succ});errLength.length?_this2.$notify.error({title:"提示",message:"本次上传失败"+errLength+"个文件，可重新上传"}):(_this2.handleClose(),_this2.$notify.success({title:"成功",message:"本次上传成功"+_this2.successFiles.length+"个文件"})),_this2.loading=!1}}else _this2.loading=!1;return 200===res.code}).catch(function(_){return _this2.loading=!1})},sendImg:function(rowFile,url){var msg_id=this.$imConn.getUniqueId(),_this=this,webkitURL=window.URL||window.webkitURL,img=new Image;img.src=webkitURL.createObjectURL(rowFile.data),img.onload=function(){var _this3=this,data=extends_default()({},_this.defaultData,{msg_id:msg_id,msg_type:"img",fid:rowFile.fid,timestamp:+new Date,payload:stringify_default()({file_length:rowFile.data.size,filename:rowFile.filename,type:"img",size:{width:this.width,height:this.height},url:url})});_this.saveMessage(data).then(function(res){res&&easemob.l(_this.$imConn,{easemobname:_this.activeItem.targetuser,chatType:"group"===_this.activeItem.type?"chatRoom":"singleChat",msg_id:msg_id},{}).then(function(_){actions.R(data.type,data.msg_id,!0)}).catch(function(_){_this3.loading=!1,_this3.$notify.error({title:"失败",message:"上传失败，请重试"})})})}},sendFile:function(rowFile,url){var _this4=this,msg_id=this.$imConn.getUniqueId(),data=extends_default()({},this.defaultData,{msg_id:msg_id,msg_type:"file",fid:rowFile.fid,payload:stringify_default()({file_length:rowFile.data.size,filename:rowFile.filename,type:"file",url:url}),timestamp:+new Date});this.saveMessage(data).then(function(res){res&&easemob.k(_this4.$imConn,{easemobname:_this4.activeItem.targetuser,chatType:"group"===_this4.activeItem.type?"chatRoom":"singleChat",msg_id:msg_id},{}).then(function(_){actions.R(data.type,data.msg_id,!0)}).catch(function(_){_this4.loading=!1,_this4.$notify.error({title:"失败",message:"上传失败，请重试"})})})},handleConfirm:function(){var _this5=this;if(this.currentFiles.length)if(this.currentFiles.filter(function(v){return v.size>_this5.isLt10M}).length)this.$notify.warning({title:"警告",message:"请删除大于 10MB 的文件重新上传"});else{this.loading=!0;var i=void 0,_loop=function(){var arr=_this5.currentFiles[i].name.split("."),data={rowFile:{data:_this5.currentFiles[i],filename:_this5.currentFiles[i].name,filetype:arr[arr.length-1],url:URL.createObjectURL(_this5.currentFiles[i])},fid:i};(fromData=new FormData).append("multipartFile",_this5.currentFiles[i]),actions.fb(fromData).then(function(res){200===res.code?(data.rowFile.filetype.toLowerCase()in _this5.$options.filters.imgsType?_this5.sendImg(data.rowFile,res.result):_this5.sendFile(data.rowFile,res.result),_this5.successFiles.push({fid:data.fid,succ:!0})):(_this5.loading=!1,_this5.successFiles.push({fid:data.fid,succ:!1}))}).catch(function(_){_this5.loading=!1,_this5.successFiles.push({fid:data.fid,succ:!1})})};for(i=0;i<this.currentFiles.length;i++){var fromData;_loop()}}else this.$notify.warning({title:"警告",message:"还未选择任何文件"})},handleClose:function(){this.$emit("update:visible",!1)},handleDelete:function(index){this.currentFiles.splice(index,1)},iconfile:function(name){var arr=name.split("."),type=arr[arr.length-1];return this.$options.filters.currentFileIcon(type)}},computed:{activeItem:function(){return this.$store.getters.activeItem},easemobname:function(){return this.$store.state.userData.easemobname},defaultData:function(){return{from_user:this.easemobname,to_user:this.activeItem.targetuser,modle_code:1,chat_type:"group"===this.activeItem.type?"groupchat":"chat",type:this.activeItem.type}},message:function(){return this.$store.state.message}}},filesList_component=(__webpack_require__("4kfO"),__webpack_require__("Zck/"),Object(componentNormalizer.a)(message_filesListvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("el-dialog",{attrs:{visible:_vm.visible,"custom-class":"headDialog",width:"396px",top:"17vh","show-close":!1,"append-to-body":"",center:""}},[_c("div",{staticClass:"header",on:{click:_vm.handleClose}},[_vm._v("上传文件\n        "),_c("i",{staticClass:"iconfont icon-close"})]),_vm._v(" "),_c("div",{staticClass:"filesList"},[_c("div",{staticClass:"total"},[_vm._v("本次一共选择了 "+_vm._s(_vm.currentFiles.length)+" 个文件")]),_vm._v(" "),_c("el-scrollbar",{ref:"scrollbar",staticClass:"main-scroll",attrs:{tag:"div"}},_vm._l(_vm.currentFiles,function(file,index){return _c("div",{key:file.lastModified+file.name,class:["files",{"file-error":file.size>_vm.isLt10M||_vm.successFiles.find(function(v){return v.fid===index&&!v.succ}),"file-success":_vm.successFiles.find(function(v){return v.fid===index&&v.succ})}]},[_c("div",{staticClass:"left"},[_c("i",{class:["iconfont",_vm.iconfile(file.name)]}),_vm._v(" "),_c("div",{staticClass:"des"},[_c("span",{staticClass:"filename"},[_vm._v(_vm._s(file.name))]),_vm._v(" "),_c("span",{staticClass:"filesize"},[_vm._v(_vm._s(_vm.$options.filters.isFilesize(file.size)))])])]),_vm._v(" "),_c("i",{staticClass:"iconfont icon-close",on:{click:function($event){_vm.handleDelete(index)}}})])}))],1),_vm._v(" "),_c("div",{staticClass:"dialog-footer"},[_c("el-button",{attrs:{type:"primary",loading:_vm.loading,round:""},on:{click:_vm.handleConfirm}},[_vm._v(_vm._s(_vm.loading?"上传中":"确 定"))])],1)])},[],!1,null,"c9a0ede4",null));filesList_component.options.__file="index.vue";var message_accessoryvue_type_script_lang_js_={components:{FilesList:filesList_component.exports},data:function(){return{visible:!1,files:[],dom:""}},watch:{visible:function(value){value||(this.files=[],this.$refs.accInput.value=null)}},methods:{onVoiceCall:function(){1<keys_default()(this.callUser).length?this.$notify.warning({title:"警告",message:"你还有未结束的通话！"}):(this.$store.commit("setCallUser",extends_default()({},this.activeItem,{originator:this.username,loading:!0,waitTime:!0})),this.$rtcCall.caller=this.easemobname,this.$rtcCall.makeVoiceCall(this.activeItem.targetuser))},onVideoCall:function(){1<keys_default()(this.callUser).length?this.$notify.warning({title:"警告",message:"你还有未结束的通话！"}):(this.$store.commit("setCallUser",extends_default()({},this.activeItem,{originator:this.username,loading:!0,waitTime:!0})),this.$rtcCall.caller=this.easemobname,this.$rtcCall.makeVideoCall(this.activeItem.targetuser))},handleUp:function(e){this.visible=!0,this.files=e.target.files,this.dom=this.$refs.accInput}},computed:{easemobname:function(){return this.$store.state.userData.easemobname},username:function(){return this.$store.state.userData.username},activeItem:function(){return this.$store.getters.activeItem},callUser:function(){return this.$store.state.callUser}}},accessory_component=(__webpack_require__("m6lo"),Object(componentNormalizer.a)(message_accessoryvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"accessory"},[_c("files-list",{attrs:{visible:_vm.visible,files:_vm.files,dom:_vm.dom},on:{"update:visible":function($event){_vm.visible=$event}}}),_vm._v(" "),_c("input",{ref:"accInput",attrs:{id:"accInput",type:"file",multiple:""},on:{change:_vm.handleUp}}),_vm._v(" "),_vm._m(0),_vm._v(" "),"person"===_vm.activeItem.type?_c("label",{on:{click:function($event){return $event.stopPropagation(),_vm.onVoiceCall($event)}}},[_c("i",{staticClass:"iconfont icon-voice-call"})]):_vm._e(),_vm._v(" "),"person"===_vm.activeItem.type?_c("label",{on:{click:function($event){return $event.stopPropagation(),_vm.onVideoCall($event)}}},[_c("i",{staticClass:"iconfont icon-video-call"})]):_vm._e()],1)},[function(){var _h=this.$createElement,_c=this._self._c||_h;return _c("label",{attrs:{for:"accInput"}},[_c("i",{staticClass:"iconfont icon-accessory"})])}],!1,null,"782154d7",null));accessory_component.options.__file="index.vue";var message_messageFieldvue_type_script_lang_js_={components:{Accessory:accessory_component.exports},props:{activeItem:Object},watch:{activeItem:{immediate:!0,handler:function(){var _this=this;this.$nextTick(function(){_this.isChat&&_this.$refs.textarea.focus()})}}},data:function(){return{value:""}},methods:{handleInput:function(e){this.value=e.target.value},handleKeyDown:function(event){if(event.stopPropagation(),event.ctrlKey&&13===event.keyCode){var textarea=this.$refs.textarea,index=textarea.selectionStart,value=this.value.split("");value.splice(index,0,"\n"),this.value=value.join(""),textarea.setSelectionRange&&textarea.setSelectionRange(index+1,index+1)}else 13===event.keyCode&&this.handleSend()},saveMessage:function(data){var _this2=this,prevTimestamp=this.message.length?this.message[this.message.length-1].timestamp:"",isrecord=!prevTimestamp||3e5<data.timestamp-prevTimestamp;return this.$store.commit("addMessage",extends_default()({},data,{isrecord:isrecord})),actions.T(extends_default()({},data,{isrecord:isrecord})).then(function(res){return 200===res.code&&_this2.$store.commit("updateItem",extends_default()({},_this2.activeItem,{timestamp:data.timestamp,payload:data.payload})),200===res.code})},chatSend:function(message,defaultData){var _this3=this,msg_id=this.$imConn.getUniqueId(),data=extends_default()({},defaultData,{msg_id:msg_id,chat_type:"chat",type:"person"});this.saveMessage(data).then(function(res){res&&easemob.m(_this3.$imConn,data).then(function(_){actions.R(data.type,data.msg_id,!0)})})},groupchatSend:function(message,defaultData){var _this4=this,msg_id=this.$imConn.getUniqueId(),data=extends_default()({},defaultData,{msg_id:msg_id,chat_type:"groupchat",type:"group"});this.saveMessage(data).then(function(res){res&&easemob.j(_this4.$imConn,data).then(function(_){actions.R(data.type,data.msg_id,!0)})})},handleSend:function(){var _this5=this;if(this.$options.filters.trim(this.value)){this.$store.state.userData.usercode;var message=this.value;500<this.value.length&&(message=this.value.slice(0,500),this.$notify.info({title:"提示",message:"文字过长，已自动截断，建议将长文字通过附件形式发送",duration:5500}));var defaultData={timestamp:+new Date,from_user:this.easemobname,to_user:this.activeItem.targetuser,msg_type:"txt",modle_code:1,payload:stringify_default()({msg:message,type:"txt"})};"person"===this.activeItem.type&&this.chatSend(message,defaultData),"group"===this.activeItem.type&&this.groupchatSend(message,defaultData),this.$nextTick(function(){_this5.$store.commit("addItem",_this5.activeItem)})}this.$nextTick(function(){_this5.value=""})},handleError:function(){}},computed:{isChat:function(){return"person"===this.activeItem.type||"group"===this.activeItem.type},message:function(){return this.$store.state.message},easemobname:function(){return this.$store.state.userData.easemobname}}},messageField_component=(__webpack_require__("fkx2"),Object(componentNormalizer.a)(message_messageFieldvue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _vm.isChat?_c("div",{staticClass:"field"},[_c("accessory"),_vm._v(" "),_c("div",{staticClass:"messageField"},[_c("textarea",{ref:"textarea",staticClass:"textarea",attrs:{type:"text",autofocus:""},domProps:{value:_vm.value},on:{input:_vm.handleInput,keydown:_vm.handleKeyDown}}),_vm._v(" "),_c("div",{class:["send",{nothing:!this.$options.filters.trim(_vm.value)}],on:{click:_vm.handleSend}},[_vm._v("发送")])])],1):_vm._e()},[],!1,null,"47cdfd34",null));messageField_component.options.__file="index.vue";var views_messagevue_type_script_lang_js_={components:{HistoryList:historyList,MessageHeader:messageHeader,MessageView:messageView,MessageField:messageField_component.exports},computed:{activeItem:function(){return this.$store.getters.activeItem},historyId:function(){return this.$store.state.historyId},greetings:function(){var icon=void 0,text=void 0,times=(new Date).getHours();return 0<=times&&times<7&&(icon="moon",text="凌晨好，将美丽的月色送给辛苦工作的你~"),7<=times&&times<11&&(icon="sun",text="早上好，今天的你准备好了吗？"),11<=times&&times<13&&(icon="sun",text="中午好，适当休息下眼睛吧~"),13<=times&&times<19&&(icon="sun",text="下午好，打起精神，继续努力~"),19<=times&&times<24&&(icon="moon",text="晚上好，今天的你比昨天的你又进步了不少呢！"),{icon:icon,text:text}}}},message_component=(__webpack_require__("zUnh"),Object(componentNormalizer.a)(views_messagevue_type_script_lang_js_,function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"message"},[_c("history-list"),_vm._v(" "),_vm.historyId&&_vm.activeItem?_c("div",{staticClass:"main"},[_c("message-header",{attrs:{"active-item":_vm.activeItem}}),_vm._v(" "),_c("message-view",{attrs:{"active-item":_vm.activeItem}}),_vm._v(" "),_c("message-field",{attrs:{"active-item":_vm.activeItem}})],1):_c("div",{staticClass:"default"},[_vm._m(0),_vm._v(" "),_c("div",{staticClass:"greetings"},[_c("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[_c("use",{attrs:{"xlink:href":"#icon-"+_vm.greetings.icon}})]),_vm._v(_vm._s(_vm.greetings.text))])])],1)},staticRenderFns,!1,null,"9639abfe",null));message_component.options.__file="index.vue";__webpack_exports__.default=message_component.exports},KpmQ:function(module,exports,__webpack_require__){},MKW7:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_0818febe_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ZJRu");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_0818febe_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},NSGL:function(module,exports,__webpack_require__){},WWwK:function(module,exports,__webpack_require__){},ZJRu:function(module,exports,__webpack_require__){},"Zck/":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ibWd");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__).a},aB95:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_f54192e6_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("EkSU");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_f54192e6_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},chFa:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_54966110_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("iXW4");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_54966110_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},fkx2:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_47cdfd34_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("NSGL");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_47cdfd34_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},hwt1:function(module,exports,__webpack_require__){},iXW4:function(module,exports,__webpack_require__){},ibWd:function(module,exports,__webpack_require__){},kvwK:function(module,exports,__webpack_require__){},lDQv:function(module,exports,__webpack_require__){},lWqd:function(module,exports,__webpack_require__){},m6lo:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_782154d7_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("5pCn");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_782154d7_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},oLvb:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/static/images/default.f322b1f.png"},ooib:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_fce0a4f2_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("sn9F");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_fce0a4f2_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},"r+yn":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("4enB");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_3_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_3_2_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_1_lang_css___WEBPACK_IMPORTED_MODULE_0__).a},r0Ss:function(module,exports,__webpack_require__){},sn9F:function(module,exports,__webpack_require__){},vIMT:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_633cbc9f_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("r0Ss");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_633cbc9f_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},vSlj:function(module,exports,__webpack_require__){},zUnh:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_9639abfe_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("9tVp");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_9639abfe_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a},zfbk:function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_795a3fd1_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("KpmQ");__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_index_js_ref_8_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_2_node_modules_stylus_loader_index_js_ref_8_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_id_795a3fd1_lang_stylus_scoped_true___WEBPACK_IMPORTED_MODULE_0__).a}}]);